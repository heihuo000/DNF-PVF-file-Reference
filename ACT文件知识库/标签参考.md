# ACT文件标签参考

## 概述

ACT文件是DNF中控制角色、怪物和对象行为的核心文件。本文档详细介绍了ACT文件中所有重要标签的功能、参数和使用方法。

## 动作控制标签

### [MOTION] - 动作定义

**功能作用**
- 定义角色或对象的基础动作行为
- 控制动画播放、语音、音效等综合表现

**参数详解**
```
[MOTION]
	[BASE ANI] `动画文件路径`		// 基础动画文件
	[SUB ANI]				// 子动画序列
		`动画路径` 帧数 权重		// 动画文件、起始帧、权重值
	[/SUB ANI]
	
	[SUB ANI WITH XY]			// 带坐标的子动画
		`动画路径` 帧数1 帧数2 X坐标 Y坐标
	[/SUB ANI WITH XY]
[/MOTION]
```

**实际应用**
```
[MOTION]
	[BASE ANI] `../Animation/attack.ani`
	[SUB ANI]
		`../equipment/weapon/sword_effect.ani` 0 100
	[/SUB ANI]
[/MOTION]
```

**依赖关系**
- 依赖ANI动画文件
- 可配合SPEECH、SOUND标签使用

**使用注意事项**
- 动画路径必须使用反引号包围
- 权重值影响动画播放优先级
- 坐标值相对于角色中心点

### [BASE ANI] - 基础动画

**功能作用**
- 指定动作的主要动画文件
- 作为动作的核心表现

**参数详解**
- 参数: 动画文件路径 (字符串)
- 路径必须相对于当前文件位置
- 支持.ani格式动画文件

**实际应用**
```
[BASE ANI] `../Animation/character/attack_basic.ani`
```

### [SUB ANI] - 子动画

**功能作用**
- 添加装备或特效的附加动画
- 与基础动画同步播放

**参数详解**
- 动画路径: 子动画文件位置
- 起始帧: 动画开始播放的帧数
- 权重: 动画播放的权重值(0-100)

**实际应用**
```
[SUB ANI]
	`../equipment/weapon/sword_glow.ani` 0 100
	`../effect/slash_effect.ani` 5 80
[/SUB ANI]
```

## 语音控制标签

### [SPEECH] - 语音播放

**功能作用**
- 控制角色语音的播放
- 支持多语音随机播放

**参数详解**
```
[SPEECH]
	`语音文件名` 起始帧 播放概率
[/SPEECH]
```

**实际应用**
```
[SPEECH]
	`attack_voice_01` 0 30
	`attack_voice_02` 1 50
[/SPEECH]
```

**依赖关系**
- 依赖音频文件资源
- 必须在MOTION标签内使用

### [SPEECH POS] - 定位语音

**功能作用**
- 播放带有位置信息的语音
- 用于3D音效定位

**参数详解**
- 语音文件: 音频资源名称
- 起始帧: 播放开始时间
- 播放概率: 触发概率(0-100)
- X坐标: 水平位置
- Y坐标: 垂直位置

## 音效控制标签

### [SOUND] - 音效播放

**功能作用**
- 控制动作音效的播放
- 与动画帧同步

**参数详解**
```
[SOUND]
	`音效标签` 播放帧数
[/SOUND]
```

**实际应用**
```
[SOUND]
	`SWORD_SLASH` 5
	`IMPACT_SOUND` 12
[/SOUND]
```

### [SOUND PROBABILITY] - 概率音效

**功能作用**
- 按概率播放音效
- 增加音效的随机性

**参数详解**
- 音效标签: 音效资源名称
- 播放帧数: 触发时间点
- 播放概率: 触发概率(0-100)

**实际应用**
```
[SOUND PROBABILITY]
	`CRITICAL_HIT` 8 30
[/SOUND PROBABILITY]
```

## 位置控制标签

### [HOLD POSITION] - 保持位置

**功能作用**
- AI角色执行动作时不移动位置
- 用于固定位置的攻击或施法

**使用场景**
- 远程攻击动作
- 施法动作
- 防御姿态

**实际应用**
```
[HOLD POSITION]
```

## 攻击信息标签

### [DEFAULT ATTACKINFO] - 默认攻击信息

**功能作用**
- 指定动作的默认攻击数据
- 定义伤害、范围等属性

**参数详解**
- 攻击信息文件路径: ATK文件位置

**实际应用**
```
[DEFAULT ATTACKINFO] `../AttackInfo/sword_attack.atk`
```

**依赖关系**
- 依赖ATK攻击信息文件
- 影响伤害计算和判定

## 触发器标签

### [TRIGGER] - 触发器定义

**功能作用**
- 定义条件触发的行为
- 实现复杂的交互逻辑

**基础结构**
```
[TRIGGER]
	[LIMIT] 触发次数限制
	[ENABLE] [ON]/[OFF]
	[CHECK TIME] 检查间隔时间
	[FRAME] 起始帧 结束帧
	
	// 触发条件
	[触发条件标签]
	
	// 目标选择
	[WHICH] [目标类型]
	
	// 条件检查
	[CHECKUP]
		[检查条件]
	[/CHECKUP]
	
	// 执行行为
	[DO BEHAVIOR] [目标] 行为编号
[/TRIGGER]
```

### 触发条件标签

#### [ON DAMAGE] - 受到伤害时

**功能作用**
- 角色受到攻击时触发
- 用于反击、防御反应等

**实际应用**
```
[TRIGGER]
	[ON DAMAGE]
	[WHICH] [ME]
	[DO BEHAVIOR] [ME] 5
[/TRIGGER]
```

#### [ON ATTACKSUCCESS] - 攻击成功时

**功能作用**
- 攻击命中目标时触发
- 用于连击、特效等

#### [IS MEET PROB] - 概率触发

**功能作用**
- 按指定概率触发行为
- 增加行为的随机性

**参数详解**
- 概率值: 0-100的整数

**实际应用**
```
[IS MEET PROB] 30	// 30%概率触发
```

#### [CHECK STUCK] - 检查硬直状态

**功能作用**
- 检查目标是否处于硬直状态
- 配合ON DAMAGE或ON ATTACKSUCCESS使用

**参数详解**
- 1: 检查硬直状态
- 0: 检查非硬直状态

#### [IS MOUNT] - 检查骑乘状态

**功能作用**
- 检查角色是否处于骑乘状态
- 用于骑乘相关的行为判断

**参数详解**
- 1: 检查是否骑乘
- 0: 检查是否未骑乘

### 对象控制标签

#### [ON CREATE OBJECT] - 对象创建时

**功能作用**
- 对象被创建时触发
- 用于初始化行为

#### [ON DESTROY OBJECT] - 对象销毁时

**功能作用**
- 对象被销毁时触发
- 用于清理或爆炸效果

#### [ON DESTROY ME] - 自身销毁时

**功能作用**
- 自身被销毁时触发
- 用于死亡特效或遗言

#### [ON REMOVE ACTION] - 动作移除时

**功能作用**
- 动作被中断或移除时触发
- 用于状态清理

#### [ON SET ACTION] - 动作设置时

**功能作用**
- 新动作开始时触发
- 用于状态初始化

### 目标选择标签 [WHICH]

#### 基础目标类型

- `[ME]`: 自身
- `[TARGET]`: AI当前目标
- `[SUMMON MASTER]`: 召唤主人
- `[SUMMON OBJECT]`: 召唤对象
- `[LAST ATTACKER]`: 最后攻击者
- `[LAST ACTIVE ATTACKER]`: 最后活跃攻击者
- `[LAST ATTACKSUCCESS]`: 最后攻击成功的对象
- `[CHARACTER ATTACKSUCCESS]`: 攻击成功的角色

#### 团队目标类型

- `[ALL OUR TEAM]`: 我方全体
- `[ALL ENEMY]`: 敌方全体
- `[ALL MONSTER TEAM]`: 怪物团队
- `[ALL CHARACTER TEAM]`: 角色团队
- `[CHARACTER]`: 所有角色
- `[MONSTER]`: 所有怪物
- `[PASSIVE]`: 所有被动对象
- `[AI CHARACTER]`: 所有AI角色

#### 特殊目标类型

- `[CREATE OBJECT]`: 被创建的对象
- `[DESTROY OBJECT]`: 被销毁的对象
- `[LOAD TARGET] 索引`: 加载指定索引的目标
- `[PARTY TARGET]`: 特定队伍成员

### 条件检查标签 [CHECKUP]

#### 名称和类别检查

```
[IS NAME] `对象名1` `对象名2` [/IS NAME]
[IS CATEGORY] `类别1` `类别2` [/IS CATEGORY]
```

**支持的类别**
- 种族类别: `human`, `beast`, `plant`, `insect`, `machine`, `undead`, `devil`, `spirit`, `dragon`
- AI类别: `melee combat`, `range combat`, `close-passive`, `close-carefully`
- 护甲类别: `human armor`, `fort armor`, `divine armor`
- 特殊类别: `goblin`, `tau`, `lugaru`, `fixture`, `stay`

#### 索引检查

```
[IS INDEX] 1 2 3 [/IS INDEX]		// 检查是否为指定索引
[IS NOT INDEX] 1 2 3 [/IS NOT INDEX]	// 检查是否不为指定索引
```

#### 对象类型检查

```
[IS OBJECT TYPE] [PASSIVE OBJECT] [CHARACTER] [/IS OBJECT TYPE]
```

#### 团队检查

```
[IS TEAM] [MY TEAM] [ENEMY TEAM] [MONSTER TEAM] [CHARACTER TEAM] [/IS TEAM]
```

#### 位置检查

```
[IS END MAP]				// 检查是否在地图边缘
[IS END MAP VERTICALLY]			// 检查是否在地图上下边缘
[IS IN POS] X坐标 Y坐标 Z坐标		// 检查是否在指定位置
[IS IN AREA]				// 检查是否在指定区域
	[POS] X坐标 Y坐标 Z坐标
	[RANGE] X范围 Y范围 Z范围
	[COORDINATE] `RELATIVE`/`ABSOLUTE`
[/IS IN AREA]
```

#### 状态检查

```
[IS TARGET STATE] 状态编号		// 检查目标状态
[IS NOT TARGET STATE] 状态编号	// 检查目标非指定状态
```

**状态编号说明**
- 0: 站立/移动
- 1: 跳跃
- 2: 跳跃中
- 3: 倒地
- 4: 下蹲
- 5: 爬行
- 6: 攻击
- 7: 攻击后
- 8: 受击
- 9: 抓取
- 10: 召唤中
- 11: 召唤完成

#### 速度检查

```
[X SPEED] [比较符号] 数值		// X轴速度检查
[Y SPEED] [比较符号] 数值		// Y轴速度检查
[Z SPEED] [比较符号] 数值		// Z轴速度检查
```

**比较符号**: `>`, `<`, `=`, `>=`, `<=`, `=>`, `=<`

#### 属性检查

```
[HP] [比较符号] 数值 [%]/[POINT]	// HP检查
[MP] [比较符号] 数值 [%]/[POINT]	// MP检查
[ZPOS] [比较符号] 数值		// Z坐标检查
[DISTANCE] [比较符号] 数值		// 距离检查
[CHECK DISTANCE] X距离 Y距离	// 指定距离检查
```

#### 异常状态检查

```
[IS TARGETACTIVESTATUS] 状态编号
```

**异常状态编号**
- 0: 缓慢
- 1: 冰冻
- 2: 中毒
- 3: 眩晕
- 4: 诅咒
- 5: 失明
- 6: 感电
- 7: 石化
- 8: 睡眠
- 9: 灼烧
- 10: 武器破坏
- 11: 出血
- 12: 加速
- 13: 祝福
- 14: 元素
- 15: 混乱
- 16: 抓取
- 17: 护甲破坏

#### 方向检查

```
[FRONTSIDE]		// 检查是否在前方
[BACKSIDE]		// 检查是否在后方
[IS LEFT]		// 检查是否在左侧
[IS RIGHT]		// 检查是否在右侧
[WITHIN SIGHT]		// 检查是否在视野内
[OUT OF SIGHT]		// 检查是否在视野外
[IS FRONTPOS]		// 检查是否在前方位置
[FACE TO FACE]		// 检查是否面对面
```

#### 特殊检查

```
[CHECK SYMBOL] 符号类型 符号编号	// 符号检查
[IS CHILD] 1/0			// 检查是否为子对象
[IS GRABABLE] 距离		// 检查是否可抓取
[CHECK AREA] X左 X右 Y上 Y下	// 区域检查
[IS DAMAGE ENABLE]		// 检查是否可造成伤害
[IS DAMAGEBOX ENABLE] 索引	// 检查伤害盒是否启用
```

### 行为执行标签

#### [DO BEHAVIOR] - 执行行为

**功能作用**
- 让指定目标执行特定行为
- 触发器的核心执行部分

**参数详解**
- 目标类型: 行为执行的对象
- 行为编号: 要执行的行为索引

**实际应用**
```
[DO BEHAVIOR] [ME] 3		// 自身执行3号行为
[DO BEHAVIOR] [TARGET] 1	// 目标执行1号行为
```

#### [DO PROC BEHAVIOR] - 执行PROC行为

**功能作用**
- 执行PROC类型的特殊行为
- 用于装备或技能的特殊效果

#### [DIRECT DO BEHAVIOR] - 直接执行行为

**功能作用**
- 立即执行行为，无延迟
- 用于即时反应

#### [DELAY DO BEHAVIOR] - 延迟执行行为

**功能作用**
- 延迟指定时间后执行行为
- 用于定时触发效果

**参数详解**
- 目标类型: 执行对象
- 行为编号: 行为索引
- 延迟时间: 毫秒为单位

**实际应用**
```
[DELAY DO BEHAVIOR] [TARGET] 2 1000	// 1秒后目标执行2号行为
```

### 目标管理标签

#### [GET TARGET] - 获取目标

**功能作用**
- 根据条件选择新的目标
- 用于AI目标切换

**参数详解**
```
[GET TARGET] 数量 [属性] [排序方式]
```

**支持的属性和排序**
- `[HP] [LOW]/[HIGH]`: 按HP排序
- `[MP] [LOW]/[HIGH]`: 按MP排序
- `[LEVEL] [LOW]/[HIGH]`: 按等级排序
- `[DISTANCE] [LOW]/[HIGH]`: 按距离排序
- `[RANDOM]`: 随机选择
- `[LAST ATTACKSUCCESS] [LOW]/[HIGH]`: 按最近攻击成功排序

**实际应用**
```
[GET TARGET] 1 [HP] [LOW]		// 获取HP最低的目标
[GET TARGET] 3 [DISTANCE] [LOW]		// 获取距离最近的3个目标
[GET TARGET] 1 [RANDOM]			// 随机获取1个目标
```

#### [SAVE TARGET OBJECT] - 保存目标对象

**功能作用**
- 将当前目标保存到指定索引
- 用于目标记忆和切换

**参数详解**
- 索引编号: 保存位置(0-9)
- 目标类型: 要保存的目标

**实际应用**
```
[SAVE TARGET OBJECT] 0 [TARGET]		// 将当前目标保存到0号位置
[SAVE TARGET OBJECT] 1 [LAST ATTACKER]	// 将最后攻击者保存到1号位置
```

### 伤害类型检查标签

```
[IS MISSILE DAMAGE]		// 是否为远程伤害
[IS PHYSICAL DAMAGE]		// 是否为物理伤害
[IS MAGICAL DAMAGE]		// 是否为魔法伤害
[IS ABSOLUTE DAMAGE]		// 是否为绝对伤害
[IS FIRE DAMAGE]		// 是否为火属性伤害
[IS WATER DAMAGE]		// 是否为水属性伤害
[IS DARK DAMAGE]		// 是否为暗属性伤害
[IS LIGHT DAMAGE]		// 是否为光属性伤害
[IS NONE DAMAGE]		// 是否为无属性伤害
```

### 方向检查标签

```
[IS DIRECTION LEFT]		// 是否朝向左侧
[IS DIRECTION RIGHT]		// 是否朝向右侧
```

### 随机和概率标签

#### [RANDOM CHECK] - 随机检查

**功能作用**
- 进行随机概率判断
- 用于随机事件触发

**参数详解**
- 分子: 成功次数
- 分母: 总次数

**实际应用**
```
[RANDOM CHECK] 1 10		// 1/10概率成功
[RANDOM CHECK] 3 5		// 3/5概率成功
```

### 队伍状态检查标签

```
[CHECK PARTYMEMBERS STATE][ALL ALIVE]		// 检查队伍全员存活
[CHECK PARTYMEMBERS STATE][EVEN ONE DEATH]	// 检查是否有队员死亡
```

## 行为定义标签

### [BEHAVIOR] - 行为定义

**功能作用**
- 定义具体的行为内容
- 包含创建对象、移动、攻击等操作

**基础结构**
```
[BEHAVIOR]
	[行为类型标签]
		[参数设置]
[/BEHAVIOR]
```

### [CREATE PASSIVEOBJECT] - 创建被动对象

**功能作用**
- 创建子弹、特效等被动对象
- 实现远程攻击和特效

**参数详解**
```
[CREATE PASSIVEOBJECT]
	[INDEX] 对象索引编号
	[PARTICLE FILENAME] `粒子文件路径`
	[LEVEL] 等级
	[POS] X坐标 Y坐标 Z坐标
	[USE ANGLE] 角度 Z轴角度 速度 碰撞处理方式
	[USE NEUTRAL TEAM]		// 使用中立队伍
	[USE TARGET TEAM]		// 使用目标队伍
	[USE MY DIRECTION]		// 使用自身方向
	[USE MY BASEPOS]		// 使用自身基础位置
	[FIX DIRECTION] [LEFT]/[RIGHT]/[RANDOM]/[NEUTRAL]
	[USE MAP POS]			// 使用地图坐标
	[WARNING MARK] X偏移 Y偏移 持续时间 标记类型
	[USE OBJECT ZPOS]		// 使用对象Z坐标
[/CREATE PASSIVEOBJECT]
```

**碰撞处理方式**
- 0: 穿透
- 1: 反弹移动
- 2: 停止
- 3: 消失

**标记类型**
- 1: 红色圆形
- 2: 蓝色圆形
- 3: 红色方形(我方可见)
- 4: 蓝色方形(我方可见)
- 5: 黄色圆形
- 6: 绿色圆形

**实际应用**
```
[CREATE PASSIVEOBJECT]
	[INDEX] 30001
	[PARTICLE FILENAME] `../Particle/FireBall.ptl`
	[LEVEL] 1
	[POS] 50 0 80
	[USE ANGLE] 0 0 300 2
	[USE TARGET TEAM]
[/CREATE PASSIVEOBJECT]
```

**依赖关系**
- 依赖PTL粒子文件
- 依赖OBJ对象定义文件
- 影响游戏性能，需要合理控制数量

**使用注意事项**
- INDEX必须唯一，避免冲突
- 坐标系统相对于创建者
- 速度和角度影响对象轨迹
- 合理设置碰撞处理避免卡顿

## 格式规范要点

1. **字符串格式**: 所有字符串必须使用反引号(\`)包围，不能使用双引号
2. **缩进格式**: 使用Tab键缩进，不使用空格
3. **标签嵌套**: 严格按照层级关系嵌套标签
4. **参数顺序**: 按照文档中的参数顺序填写
5. **数值范围**: 注意各参数的有效取值范围
6. **文件路径**: 使用相对路径，注意路径分隔符

## 常见错误避免

1. **字符串错误**: 使用双引号而非反引号
2. **缩进错误**: 使用空格而非Tab键
3. **标签不匹配**: 开始标签和结束标签不对应
4. **参数缺失**: 必需参数未填写
5. **数值越界**: 参数值超出有效范围
6. **路径错误**: 文件路径不正确或文件不存在

## 性能优化建议

1. **合理使用触发器**: 避免过多的实时检查
2. **控制对象数量**: 限制同时存在的被动对象数量
3. **优化检查条件**: 使用高效的检查条件组合
4. **避免无限循环**: 确保触发条件有明确的结束条件
5. **资源管理**: 及时清理不需要的对象和效果

---

*本文档基于官方ACT文件样例编写，遵循PVF文件格式规范*