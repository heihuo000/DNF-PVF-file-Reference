# ACT文件常见问题解答

## 基础问题

### Q1: ACT文件是什么？有什么作用？
**A**: ACT文件是DNF游戏中的动作控制文件，用于定义角色、怪物、技能等的行为逻辑。它控制动画播放、音效触发、攻击判定、AI行为等各个方面。

### Q2: ACT文件的基本结构是什么？
**A**: ACT文件主要包含以下几个部分：
- `[MOTION]` - 动作控制（动画、音效等）
- `[DEFAULT ATTACKINFO]` - 默认攻击信息
- `[TRIGGER]` - 触发器（条件判断和行为执行）
- `[BEHAVIOR]` - 行为定义

### Q3: 为什么我的ACT文件会导致游戏崩溃？
**A**: 常见原因包括：
1. **格式错误** - 使用了双引号`""`而不是反引号`` ` ``
2. **缩进错误** - 使用了空格而不是Tab键缩进
3. **文件路径错误** - 引用的文件不存在
4. **语法错误** - 标签不匹配或参数错误

## 格式规范问题

### Q4: 字符串应该用什么符号包围？
**A**: 必须使用反引号`` ` ``包围字符串，绝对不能使用双引号`""`。
```
正确: [name] `血影·鬼切`
错误: [name] "血影·鬼切"
```

### Q5: 缩进应该使用什么？
**A**: 必须使用Tab键进行缩进，不能使用空格。每个层级使用一个Tab。
```
正确:
[MOTION]
	[BASE ANI] `../Animation/attack.ani`
[/MOTION]

错误:
[MOTION]
    [BASE ANI] `../Animation/attack.ani`
[/MOTION]
```

### Q6: 标签的开始和结束如何匹配？
**A**: 每个开始标签都必须有对应的结束标签，结束标签在开始标签前加`/`。
```
[MOTION]
    内容...
[/MOTION]

[TRIGGER]
    内容...
[/TRIGGER]
```

## 动画相关问题

### Q7: 动画不播放怎么办？
**A**: 检查以下几点：
1. 动画文件路径是否正确
2. 动画文件是否存在
3. `[BASE ANI]`标签是否正确设置
4. 动画文件格式是否正确

### Q8: 子动画如何与主动画同步？
**A**: 使用`[SUB ANI]`的时间参数控制同步：
```
[SUB ANI]
    `../effect/sword_glow.ani` 5 15
[/SUB ANI]
```
其中`5`是开始帧，`15`是结束帧。

### Q9: 如何在指定位置播放子动画？
**A**: 使用`[SUB ANI WITH XY]`标签：
```
[SUB ANI WITH XY]
    `../effect/magic_circle.ani` 10 20 0 -50
[/SUB ANI WITH XY]
```
最后两个参数是X和Y偏移量。

## 音效相关问题

### Q10: 音效不播放怎么办？
**A**: 检查以下几点：
1. 音效名称是否在音效列表中存在
2. 播放时机（帧数）是否正确
3. `[SOUND]`标签格式是否正确

### Q11: 如何设置音效的播放概率？
**A**: 使用`[SOUND PROBABILITY]`标签：
```
[SOUND PROBABILITY]
    `CRITICAL_HIT` 10 50
[/SOUND PROBABILITY]
```
其中`50`表示50%的概率播放。

### Q12: 语音和音效有什么区别？
**A**: 
- `[SOUND]` - 用于播放音效（如武器声音、撞击声等）
- `[SPEECH]` - 用于播放语音（如角色台词、喊声等）

## 触发器相关问题

### Q13: 触发器不工作怎么办？
**A**: 检查以下几点：
1. 触发条件是否正确设置
2. `[CHECKUP]`条件是否满足
3. `[WHICH]`目标选择是否正确
4. `[LIMIT]`限制是否合理

### Q14: 如何设置触发器的执行次数？
**A**: 使用`[LIMIT]`参数：
```
[LIMIT] 0  # 无限次
[LIMIT] 1  # 只执行一次
[LIMIT] 3  # 最多执行3次
```

### Q15: 如何设置概率触发？
**A**: 使用`[IS MEET PROB]`标签：
```
[IS MEET PROB] 30  # 30%概率触发
```

## 攻击判定问题

### Q16: 攻击没有伤害怎么办？
**A**: 检查以下几点：
1. `[DEFAULT ATTACKINFO]`是否正确设置
2. 攻击信息文件是否存在
3. 攻击时机是否正确
4. 目标选择是否正确

### Q17: 如何设置攻击范围？
**A**: 在攻击信息文件(.atk)中设置，或在ACT中使用距离检查：
```
[CHECKUP]
    [DISTANCE] [<=] 150
[/CHECKUP]
```

### Q18: 如何区分不同类型的伤害？
**A**: 使用伤害类型检查：
```
[IS PHYSICAL DAMAGE]  # 物理伤害
[IS MAGICAL DAMAGE]   # 魔法伤害
[IS FIRE DAMAGE]      # 火属性伤害
[IS WATER DAMAGE]     # 水属性伤害
```

## AI行为问题

### Q19: 怪物AI不智能怎么办？
**A**: 优化AI逻辑：
1. 增加更多的条件判断
2. 设置合理的检查时间间隔
3. 使用多个触发器处理不同情况
4. 添加随机性避免行为过于机械

### Q20: 如何让怪物追击玩家？
**A**: 使用目标检测和距离判断：
```
[WHICH] [CHARACTER]
[CHECKUP]
    [DISTANCE] [<=] 300
    [WITHIN SIGHT]
    [IS TEAM] [ENEMY TEAM]
[/CHECKUP]
[GET TARGET] 1 [DISTANCE] [LOW]
```

### Q21: 如何实现怪物的群体行为？
**A**: 使用团队相关的触发条件：
```
[IS OURTEAMATTACKED]  # 队友被攻击
[WHICH] [ALL MONSTER TEAM]  # 选择所有怪物队友
```

## 特效相关问题

### Q22: 特效不显示怎么办？
**A**: 检查以下几点：
1. 粒子文件路径是否正确
2. `[CREATE PASSIVEOBJECT]`参数是否正确
3. 特效位置是否在可见范围内
4. 特效文件是否存在

### Q23: 如何控制特效的位置？
**A**: 使用`[POS]`和相关参数：
```
[CREATE PASSIVEOBJECT]
    [POS] 50 0 100  # X Y Z坐标
    [USE MY BASEPOS]  # 使用自己的基础位置
    [USE TARGET TEAM]  # 使用目标位置
[/CREATE PASSIVEOBJECT]
```

### Q24: 如何创建警告标记？
**A**: 使用`[WARNING MARK]`参数：
```
[WARNING MARK] 0 0 200 3  # X偏移 Y偏移 范围 持续时间
```

## 性能优化问题

### Q25: ACT文件执行效率低怎么办？
**A**: 优化建议：
1. 减少不必要的触发器
2. 增加合理的检查时间间隔
3. 使用`[LIMIT]`限制执行次数
4. 避免复杂的嵌套条件

### Q26: 如何避免触发器冲突？
**A**: 
1. 合理设置触发条件
2. 使用互斥的条件判断
3. 设置合理的优先级
4. 避免同时触发多个相似行为

## 调试技巧

### Q27: 如何调试ACT文件？
**A**: 调试方法：
1. 使用PVF MCP工具检查语法
2. 逐步添加功能，分步测试
3. 使用简单的测试用例
4. 检查游戏日志文件

### Q28: 如何快速定位问题？
**A**: 
1. 注释掉部分代码，逐步排查
2. 检查最近的修改内容
3. 对比正常工作的类似文件
4. 使用最小化测试用例

### Q29: 常见的语法检查工具有哪些？
**A**: 
1. PVF MCP - 官方推荐工具
2. 文本编辑器的语法高亮
3. 自制的格式检查脚本
4. 游戏内置的错误报告

## 高级应用

### Q30: 如何实现复杂的连击系统？
**A**: 使用多个触发器和行为组合：
```
# 第一击成功后触发第二击
[TRIGGER]
    [ON ATTACKSUCCESS]
    [IS MEET PROB] 80
    [DO BEHAVIOR] [ME] 1
[/TRIGGER]

# 第二击的具体行为
[BEHAVIOR]
    # 第二击的动作定义
[/BEHAVIOR]
```

### Q31: 如何实现条件分支逻辑？
**A**: 使用多个触发器处理不同条件：
```
# 生命值高时的行为
[TRIGGER]
    [CHECKUP]
        [HP] [>] 50 [%]
    [/CHECKUP]
    [DO BEHAVIOR] [ME] 0
[/TRIGGER]

# 生命值低时的行为
[TRIGGER]
    [CHECKUP]
        [HP] [<=] 50 [%]
    [/CHECKUP]
    [DO BEHAVIOR] [ME] 1
[/TRIGGER]
```

### Q32: 如何实现技能冷却机制？
**A**: 使用时间检查和限制：
```
[TRIGGER]
    [CHECK TIME] 5000  # 5秒冷却
    [LIMIT] 1  # 限制执行次数
    [DO BEHAVIOR] [ME] 0
[/TRIGGER]
```

## 错误代码对照

### 常见错误信息及解决方案：

**错误**: "Invalid character in string"
**原因**: 使用了双引号而不是反引号
**解决**: 将所有`""`改为`` ` ` ``

**错误**: "Unexpected indentation"
**原因**: 缩进使用了空格而不是Tab
**解决**: 将所有空格缩进改为Tab缩进

**错误**: "File not found"
**原因**: 引用的文件路径不正确或文件不存在
**解决**: 检查文件路径和文件是否存在

**错误**: "Tag mismatch"
**原因**: 开始标签和结束标签不匹配
**解决**: 检查所有标签的配对情况