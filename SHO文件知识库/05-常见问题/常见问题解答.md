# SHO文件常见问题解答

## 概述

本文档收集了在创建和修改SHO文件过程中最常遇到的问题及其解决方案，帮助开发者快速解决问题。

## 文件格式问题

### Q1: 游戏启动时提示SHO文件格式错误怎么办？

**问题现象**: 游戏启动失败，日志显示SHO文件格式错误

**常见原因**:
1. 字符串使用了双引号而不是反引号
2. 使用了空格而不是Tab字符分隔
3. 缺少必要的标签
4. 标签拼写错误

**解决方案**:
```
❌ 错误格式:
[message]    "欢迎光临"    // 使用了双引号和空格

✅ 正确格式:
[message]	`欢迎光临`	// 使用反引号和Tab字符
```

### Q2: 为什么商店在游戏中不显示？

**问题现象**: NPC存在但无法打开商店界面

**可能原因**:
1. NPC索引不匹配
2. 文件路径错误
3. 文件编码问题
4. 缺少 `[sell list]` 或 `[sell list end]` 标签

**解决方案**:
1. 检查 `[npc index]` 是否与NPC文件中的索引一致
2. 确认文件放置在正确的目录
3. 使用UTF-8编码保存文件
4. 确保商品列表标签完整

### Q3: 商品在商店中不显示怎么办？

**问题现象**: 商店可以打开，但商品列表为空

**常见原因**:
1. 物品ID不存在
2. 商品配置错误
3. 库存设置为0
4. 等级或职业限制过严

**解决方案**:
```
// 检查物品ID是否有效
[item]	2001	// 确保该ID在equipment或stackable中存在

// 检查库存设置
[stock]	-1	// -1表示无限库存，0表示缺货

// 检查访问限制
[level required]	1	// 设置合理的等级要求
[class required]	-1	// -1表示所有职业可用
```

## 配置逻辑问题

### Q4: 设置了刷新时间但商店不刷新？

**问题现象**: 配置了定时刷新但商品不更新

**原因分析**:
```
❌ 错误配置:
[refresh type]	0	// 设置为不刷新
[refresh time]	3600	// 但又设置了刷新时间

✅ 正确配置:
[refresh type]	1	// 设置为定时刷新
[refresh time]	3600	// 对应的刷新时间
```

### Q5: 折扣设置不生效？

**问题现象**: 设置了折扣但价格没有变化

**可能原因**:
1. 折扣率设置错误
2. 商品有独立折扣覆盖了全局折扣
3. 货币类型不支持折扣

**解决方案**:
```
// 全局折扣设置
[discount rate]	80	// 8折，数值范围1-100

// 检查商品是否有独立折扣
[item]	2001
[price]	1000
[discount]	90	// 商品独立折扣会覆盖全局设置
```

### Q6: VIP商店普通玩家也能访问？

**问题现象**: 设置了VIP专属但普通玩家仍可访问

**检查配置**:
```
[vip only]	1	// 确保设置为1
[access level]	30	// 同时检查等级要求
```

## 商品配置问题

### Q7: 限购设置不起作用？

**问题现象**: 设置了购买限制但玩家仍可无限购买

**常见错误**:
```
❌ 错误设置:
[max buy]	0	// 0表示无限制
[purchase limit]	0	// 0表示无限制

✅ 正确设置:
[max buy]	5	// 单次最多购买5个
[purchase limit]	10	// 总共最多购买10个
```

### Q8: 职业限制设置后其他职业仍可购买？

**问题现象**: 设置了职业限制但限制无效

**检查职业ID**:
```
[class required]	0	// 鬼剑士
[class required]	1	// 格斗家
[class required]	2	// 神枪手
[class required]	3	// 魔法师
[class required]	4	// 圣职者
[class required]	-1	// 所有职业（默认）
```

### Q9: 商品价格显示异常？

**问题现象**: 商品价格显示为负数或异常数值

**可能原因**:
1. 价格数值超出范围
2. 折扣计算错误
3. 货币类型不匹配

**解决方案**:
```
// 确保价格在有效范围内
[price]	1000	// 正整数，不要超过2147483647

// 检查折扣设置
[discount rate]	80	// 1-100之间的数值

// 确认货币类型
[currency type]	0	// 0=金币, 1=点券, 2=特殊货币
```

## 性能和稳定性问题

### Q10: 商店商品过多导致游戏卡顿？

**问题现象**: 打开商店时游戏明显卡顿

**优化建议**:
1. 控制商品数量（建议不超过50个）
2. 合理设置刷新机制
3. 避免过于复杂的配置

```
// 分页或分类商店
// 武器商店
[npc index]	50001
// 防具商店  
[npc index]	50002
// 消耗品商店
[npc index]	50003
```

### Q11: 修改SHO文件后需要重启游戏吗？

**答案**: 是的，SHO文件修改后需要重启游戏才能生效。

**注意事项**:
1. 修改前备份原文件
2. 确保文件格式正确
3. 测试修改是否生效

## 调试技巧

### Q12: 如何快速定位SHO文件问题？

**调试步骤**:
1. **检查语法**: 使用文本编辑器检查格式
2. **验证ID**: 确认所有物品ID都存在
3. **测试配置**: 逐步添加配置项测试
4. **查看日志**: 检查游戏错误日志

**常用检查清单**:
- [ ] 文件编码为UTF-8
- [ ] 使用反引号包围字符串
- [ ] 使用Tab字符分隔
- [ ] NPC索引正确
- [ ] 物品ID有效
- [ ] 标签拼写正确
- [ ] 数值在有效范围内

### Q13: 如何备份和恢复SHO文件？

**备份方法**:
```
// 修改前创建备份
weaponshop.sho.backup
```

**恢复方法**:
```
// 出现问题时恢复备份
copy weaponshop.sho.backup weaponshop.sho
```

## 最佳实践建议

### 1. 开发流程
1. 先创建简单的测试版本
2. 逐步添加功能
3. 每次修改后测试
4. 保持版本备份

### 2. 配置原则
1. 保持配置简洁明了
2. 避免过于复杂的限制条件
3. 考虑游戏平衡性
4. 注重用户体验

### 3. 维护建议
1. 定期检查和更新
2. 记录修改历史
3. 建立标准化模板
4. 团队协作规范

## 错误代码参考

### 常见错误信息
- `Invalid shop format`: 文件格式错误
- `NPC index not found`: NPC索引不存在
- `Item ID invalid`: 物品ID无效
- `Access denied`: 访问权限不足

### 解决对应关系
| 错误信息 | 可能原因 | 解决方案 |
|---------|---------|---------|
| Invalid shop format | 格式错误 | 检查标签格式和字符编码 |
| NPC index not found | NPC索引错误 | 确认NPC文件中的索引号 |
| Item ID invalid | 物品ID不存在 | 检查equipment/stackable文件 |
| Access denied | 权限限制 | 检查等级、职业、VIP等限制 |

## 技术支持

如果遇到本文档未涵盖的问题，请参考：
- [实用工具](../06-实用工具/) - 调试和验证工具
- [PVF文件格式规范](../../PVF文件格式规范.md) - 格式标准
- [DNF文件知识库总览](../../DNF文件知识库总览.md) - 相关文档索引

## 问题反馈

发现新问题或有改进建议，请通过以下方式反馈：
1. 详细描述问题现象
2. 提供相关配置代码
3. 说明预期效果
4. 附上错误日志（如有）