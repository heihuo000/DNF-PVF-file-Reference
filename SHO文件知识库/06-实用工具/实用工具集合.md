# SHO文件实用工具集合

## 概述

本文档提供了一系列用于创建、编辑、验证和调试SHO文件的实用工具和脚本，帮助开发者提高工作效率。

## 1. 文件验证工具

### SHO文件格式检查器

**功能**: 检查SHO文件的基本格式是否正确

**使用方法**:
```powershell
# 检查单个文件
python sho_validator.py weaponshop.sho

# 批量检查目录下所有SHO文件
python sho_validator.py --dir ./shops/
```

**检查项目**:
- 文件编码格式
- 字符串引号使用
- Tab字符分隔
- 必要标签完整性
- 数值范围有效性

### 物品ID验证工具

**功能**: 验证SHO文件中的物品ID是否在游戏中存在

**使用方法**:
```powershell
# 验证物品ID
python item_validator.py weaponshop.sho --pvf-path "C:\DNF\PVF\"
```

**验证范围**:
- equipment文件夹中的装备
- stackable文件夹中的消耗品
- 特殊物品ID

## 2. 文件生成工具

### SHO文件模板生成器

**功能**: 根据配置快速生成标准SHO文件

**配置文件示例** (`shop_config.json`):
```json
{
    "npc_index": 50001,
    "message": "欢迎光临武器商店",
    "shop_type": 0,
    "buy_only": 0,
    "items": [
        {
            "id": 2001,
            "price": 1000,
            "stock": -1
        },
        {
            "id": 2002,
            "price": 1500,
            "stock": 10,
            "level_required": 10
        }
    ]
}
```

**使用方法**:
```powershell
python sho_generator.py --config shop_config.json --output weaponshop.sho
```

### 批量商店生成器

**功能**: 根据Excel表格批量生成多个商店文件

**Excel格式**:
| NPC索引 | 商店名称 | 商店类型 | 物品ID | 价格 | 库存 |
|---------|----------|----------|--------|------|------|
| 50001   | 武器商店 | 0        | 2001   | 1000 | -1   |
| 50001   | 武器商店 | 0        | 2002   | 1500 | 10   |

**使用方法**:
```powershell
python batch_generator.py --excel shops.xlsx --output-dir ./generated_shops/
```

## 3. 编辑辅助工具

### SHO文件编辑器

**功能**: 提供图形界面编辑SHO文件

**特性**:
- 语法高亮
- 自动补全
- 实时格式检查
- 物品ID提示
- 预览功能

**启动方法**:
```powershell
python sho_editor.py
```

### 商品价格计算器

**功能**: 根据物品等级和稀有度计算合理价格

**使用方法**:
```powershell
# 计算单个物品价格
python price_calculator.py --item-id 2001 --level 50 --rarity epic

# 批量计算价格
python price_calculator.py --input items.txt --output prices.txt
```

**价格公式**:
```
基础价格 = 物品等级 × 稀有度系数 × 类型系数
最终价格 = 基础价格 × (1 + 随机浮动)
```

## 4. 调试工具

### SHO文件差异对比工具

**功能**: 对比两个SHO文件的差异

**使用方法**:
```powershell
python sho_diff.py old_shop.sho new_shop.sho
```

**输出示例**:
```
差异报告:
+ [item] 2003  // 新增物品
- [item] 2001  // 删除物品
~ [price] 1000 -> 1200  // 价格变更
```

### 商店配置分析器

**功能**: 分析商店配置的合理性和潜在问题

**使用方法**:
```powershell
python shop_analyzer.py weaponshop.sho
```

**分析内容**:
- 价格合理性
- 库存设置
- 访问限制
- 性能影响
- 平衡性建议

### 日志分析工具

**功能**: 分析游戏日志中的SHO相关错误

**使用方法**:
```powershell
python log_analyzer.py --log game.log --filter sho
```

**错误分类**:
- 格式错误
- ID不存在
- 权限问题
- 配置冲突

## 5. 转换工具

### Excel转SHO工具

**功能**: 将Excel表格转换为SHO文件

**Excel模板下载**: [shop_template.xlsx](./templates/shop_template.xlsx)

**使用方法**:
```powershell
python excel_to_sho.py --input shops.xlsx --output-dir ./shops/
```

### SHO转Excel工具

**功能**: 将SHO文件转换为Excel表格便于编辑

**使用方法**:
```powershell
python sho_to_excel.py --input weaponshop.sho --output weapon_shop.xlsx
```

### JSON配置转换器

**功能**: 在JSON配置和SHO文件之间转换

**使用方法**:
```powershell
# SHO转JSON
python sho_to_json.py weaponshop.sho

# JSON转SHO
python json_to_sho.py shop_config.json
```

## 6. 性能优化工具

### 商店性能分析器

**功能**: 分析商店配置对游戏性能的影响

**使用方法**:
```powershell
python performance_analyzer.py --shop weaponshop.sho
```

**分析指标**:
- 商品数量
- 刷新频率
- 复杂度评分
- 内存占用估算
- 优化建议

### 批量优化工具

**功能**: 批量优化多个SHO文件的性能

**使用方法**:
```powershell
python batch_optimizer.py --input-dir ./shops/ --output-dir ./optimized_shops/
```

**优化策略**:
- 移除冗余配置
- 合并相似商品
- 优化刷新设置
- 简化访问限制

## 7. 备份和版本管理

### 自动备份工具

**功能**: 自动备份SHO文件并管理版本

**配置文件** (`backup_config.json`):
```json
{
    "source_dir": "./shops/",
    "backup_dir": "./backups/",
    "max_versions": 10,
    "auto_backup": true,
    "backup_interval": 3600
}
```

**使用方法**:
```powershell
# 手动备份
python backup_manager.py --backup

# 启动自动备份服务
python backup_manager.py --service
```

### 版本对比工具

**功能**: 对比不同版本的SHO文件变化

**使用方法**:
```powershell
python version_diff.py --file weaponshop.sho --version1 v1.0 --version2 v1.1
```

## 8. 集成开发环境

### VSCode扩展

**功能**: 为VSCode提供SHO文件编辑支持

**特性**:
- 语法高亮
- 代码片段
- 错误检查
- 自动格式化
- 智能提示

**安装方法**:
1. 下载 `sho-language-support.vsix`
2. 在VSCode中安装扩展
3. 重启VSCode

### Sublime Text插件

**功能**: 为Sublime Text提供SHO文件支持

**安装方法**:
1. 复制插件文件到Packages目录
2. 重启Sublime Text
3. 选择SHO语法高亮

## 9. 在线工具

### Web版SHO编辑器

**功能**: 基于浏览器的在线SHO文件编辑器

**访问地址**: [http://localhost:8080/sho-editor](http://localhost:8080/sho-editor)

**启动方法**:
```powershell
python web_editor.py --port 8080
```

**特性**:
- 无需安装
- 实时预览
- 云端保存
- 协作编辑

### API服务

**功能**: 提供RESTful API进行SHO文件操作

**启动服务**:
```powershell
python api_server.py --port 5000
```

**API端点**:
- `GET /api/shops` - 获取商店列表
- `POST /api/shops` - 创建新商店
- `PUT /api/shops/{id}` - 更新商店
- `DELETE /api/shops/{id}` - 删除商店
- `POST /api/validate` - 验证SHO文件

## 10. 工具安装和配置

### 环境要求

**Python版本**: 3.7+

**依赖包**:
```
pip install pandas openpyxl flask requests beautifulsoup4
```

### 工具下载

所有工具可从以下位置下载:
- [GitHub仓库](https://github.com/dnf-tools/sho-tools)
- [本地工具包](./tools/)

### 配置文件

**全局配置** (`config.json`):
```json
{
    "pvf_path": "C:\\DNF\\PVF\\",
    "backup_enabled": true,
    "auto_validate": true,
    "default_encoding": "utf-8",
    "log_level": "INFO"
}
```

### 使用建议

1. **新手用户**: 建议从图形界面工具开始
2. **进阶用户**: 使用命令行工具提高效率
3. **团队协作**: 使用Web版工具和API服务
4. **大批量操作**: 使用批量处理工具

## 11. 故障排除

### 常见问题

**Q: 工具无法识别SHO文件**
A: 检查文件编码和格式，确保使用UTF-8编码

**Q: 物品ID验证失败**
A: 确认PVF路径设置正确，检查equipment和stackable文件夹

**Q: 生成的文件在游戏中不生效**
A: 检查文件格式，确保使用Tab字符和反引号

### 技术支持

如需技术支持，请提供:
1. 工具版本信息
2. 错误日志
3. 问题复现步骤
4. 相关配置文件

## 12. 更新日志

### v2.1.0 (2024-01-15)
- 新增Web版编辑器
- 改进性能分析器
- 修复批量生成器bug

### v2.0.0 (2024-01-01)
- 重构核心验证引擎
- 新增API服务
- 支持更多文件格式

### v1.5.0 (2023-12-01)
- 新增VSCode扩展
- 改进价格计算器
- 优化备份管理

## 相关链接

- [SHO文件知识库主页](../README.md)
- [基础信息标签](../01-基础信息标签/)
- [常见问题解答](../05-常见问题/)
- [PVF文件格式规范](../../PVF文件格式规范.md)