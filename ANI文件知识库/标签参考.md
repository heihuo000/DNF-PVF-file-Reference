# ANI文件标签参考手册

## 概述

ANI文件是DNF游戏中的动画文件，类似于Flash的封包结构。它控制着游戏中所有的动画效果，包括角色动作、特效播放、攻击判定等核心功能。

## 基础控制标签

### [LOOP]
**功能**: 控制动画是否循环播放
**参数**: 
- `0` - 不循环播放
- `1` - 循环播放

**示例**:
```
[LOOP]
1
```

**使用说明**: 
- 待机动作通常设置为1（循环）
- 攻击动作通常设置为0（不循环）
- 循环播放会在最后一帧后回到第一帧

---

### [SHADOW]
**功能**: 控制动画是否显示阴影
**参数**: 
- `0` - 不显示阴影
- `1` - 显示阴影

**示例**:
```
[SHADOW]
0
```

**使用说明**: 
- 地面角色动作通常开启阴影
- 空中特效或UI动画通常关闭阴影
- 阴影会影响游戏性能，谨慎使用

---

### [FRAME MAX]
**功能**: 定义动画的最大帧数
**参数**: 正整数，表示总帧数

**示例**:
```
[FRAME MAX]
10
```

**使用说明**: 
- 必须与实际定义的帧数一致
- 帧数从0开始计算（FRAME000, FRAME001...）
- 最大帧数决定了动画的总长度

---

## 帧定义标签

### [FRAME000]
**功能**: 定义具体的动画帧
**格式**: [FRAME + 三位数字]

**示例**:
```
[FRAME000]
[FRAME001]
[FRAME002]
```

**使用说明**: 
- 帧编号必须连续，从000开始
- 每帧包含图像、位置、延时等信息
- 帧编号不能跳跃或重复

---

## 图像控制标签

### [IMAGE]
**功能**: 指定当前帧使用的图像文件
**参数**: 
- 图像文件路径（使用反引号包围）
- 图像索引（可选，默认为0）

**示例**:
```
[IMAGE]
`character/knight/equipment/avatar/skin/kn_body0000.img`
0
```

**使用说明**: 
- 路径必须使用反引号``而不是双引号""
- 路径相对于NPK文件根目录
- 图像索引指定IMG文件中的具体图像

**依赖关系**: 
- 依赖对应的IMG图像文件
- IMG文件必须存在于指定路径

---

### [IMAGE POS]
**功能**: 设置图像在帧中的位置（基点坐标）
**参数**: 
- X坐标（像素）
- Y坐标（像素）

**示例**:
```
[IMAGE POS]
-127	-298
```

**使用说明**: 
- 坐标系以左上角为原点
- 负值表示向左/向上偏移
- 基点通常设置在角色的脚部中心

---

### [IMAGE RATE]
**功能**: 控制图像的缩放比例
**参数**: 
- X轴缩放比例（百分比）
- Y轴缩放比例（百分比）

**示例**:
```
[IMAGE RATE]
100	100
```

**使用说明**: 
- 100表示原始大小
- 小于100为缩小，大于100为放大
- X和Y可以设置不同值实现拉伸效果

---

### [IMAGE ROTATE]
**功能**: 控制图像旋转角度
**参数**: 旋转角度（弧度制）

**示例**:
```
[IMAGE ROTATE]
0.038
```

**使用说明**: 
- 正值为顺时针旋转
- 负值为逆时针旋转
- 角度使用弧度制（π ≈ 3.14159）

---

## 时间控制标签

### [DELAY]
**功能**: 设置当前帧的显示时间
**参数**: 延时时间（毫秒）

**示例**:
```
[DELAY]
100
```

**使用说明**: 
- 单位为毫秒（1秒 = 1000毫秒）
- 较小的值会使动画播放更快
- 通常设置为50-200毫秒之间

---

## 视觉效果标签

### [GRAPHIC EFFECT]
**功能**: 设置图像的混合模式和特效
**参数**: 特效类型（使用反引号包围）

**常用特效**:
- `LINEARDODGE` - 线性减淡（去黑框）
- `NORMAL` - 正常模式
- `MULTIPLY` - 正片叠底
- `SCREEN` - 滤色模式

**示例**:
```
[GRAPHIC EFFECT]
`LINEARDODGE`
```

**使用说明**: 
- LINEARDODGE最常用，可去除图像黑色背景
- 不同特效会产生不同的视觉效果
- 特效名称必须使用反引号包围

---

### [RGBA]
**功能**: 控制图像的颜色和透明度
**参数**: 
- R值（红色，0-255）
- G值（绿色，0-255）
- B值（蓝色，0-255）
- A值（透明度，0-255）

**示例**:
```
[RGBA]
255	255	255	255
```

**使用说明**: 
- 255表示最大值，0表示最小值
- RGB控制颜色，A控制透明度
- A值为0时完全透明，255时完全不透明

---

## 攻击判定标签

### [DAMAGE TYPE]
**功能**: 设置攻击类型和霸体状态
**参数**: 伤害类型（使用反引号包围）

**常用类型**:
- `SUPERARMOR` - 霸体状态
- `NORMAL` - 普通攻击
- `MAGIC` - 魔法攻击

**示例**:
```
[DAMAGE TYPE]
`SUPERARMOR`
```

**使用说明**: 
- SUPERARMOR使角色在此帧不会被打断
- 攻击技能中常用于保护关键帧
- 类型名称必须使用反引号包围

---

### [ATTACK BOX]
**功能**: 定义攻击判定框
**参数**: 
- X1, Y1, Z1（判定框起始坐标）
- X2, Y2, Z2（判定框结束坐标）

**示例**:
```
[ATTACK BOX]
-50	-100	-50
50	0	50
```

**使用说明**: 
- 定义一个3D立体的攻击范围
- 坐标相对于角色位置
- 只有在此范围内的目标才会受到攻击

---

### [DAMAGE BOX]
**功能**: 定义被击判定框
**参数**: 
- X1, Y1, Z1（判定框起始坐标）
- X2, Y2, Z2（判定框结束坐标）

**示例**:
```
[DAMAGE BOX]
-30	-150	-30
30	0	30
```

**使用说明**: 
- 定义角色可被攻击的范围
- 通常比攻击框稍小
- 影响角色的受击判定

---

## 高级控制标签

### [INTERPOLATION]
**功能**: 控制帧间插值效果
**参数**: 插值类型

**示例**:
```
[INTERPOLATION]
1
```

**使用说明**: 
- 0为关闭插值
- 1为开启线性插值
- 插值可使动画更平滑

---

### [PLAY SOUND]
**功能**: 在当前帧播放音效
**参数**: 音效文件路径

**示例**:
```
[PLAY SOUND]
`sound/effect/attack.wav`
```

**使用说明**: 
- 音效文件必须存在于指定路径
- 支持WAV和OGG格式
- 路径使用反引号包围

---

## 格式规范要点

### 1. 字符串格式
- **正确**: `character/knight/body.img`
- **错误**: "character/knight/body.img"
- 必须使用反引号``而不是双引号""

### 2. 缩进格式
- 使用Tab缩进而不是空格
- 保持一致的缩进层次
- 参数值与标签之间使用Tab分隔

### 3. 数值格式
- 整数直接写数字：`100`
- 小数保留适当精度：`0.038`
- 坐标可以为负值：`-127`

### 4. 注释规范
```
[LOOP]
1
//循环开关，1为开启循环播放
```

## 常见错误避免

### 1. 路径错误
- 确保IMG文件路径正确
- 检查文件是否存在于NPK中
- 路径分隔符使用正斜杠/

### 2. 帧数不匹配
- FRAME MAX必须与实际帧数一致
- 帧编号必须连续
- 不能有缺失的帧

### 3. 格式错误
- 字符串必须使用反引号
- 数值不能包含非法字符
- 标签名称必须完全正确

### 4. 版本兼容性
- 70版本ANI文件较小
- 85版本ANI文件较大
- 编辑后需转换回正确版本

## 性能优化建议

### 1. 帧数控制
- 避免过多的帧数
- 合理设置DELAY时间
- 删除不必要的帧

### 2. 图像优化
- 使用合适的图像尺寸
- 避免过大的缩放比例
- 合理使用特效

### 3. 判定框优化
- 攻击框不宜过大
- 被击框要合理
- 避免复杂的3D判定

---

*本文档基于DNF 70版本PVF格式编写，使用时请注意版本兼容性*