# OBJ文件结构说明

## 📋 基本格式

OBJ文件采用标准的PVF格式，具有清晰的层次结构和严格的语法规范。

### 文件头
```obj
#PVF_File

[name]                    # 对象名称（必需）
`测试特效`

[width]                   # 对象宽度（可选）
50

[layer]                   # 图层设置（可选）
`[normal]`
```

## 🏗️ 标签分类

### 基础属性标签
这些标签定义对象的基本特征：

#### [name] - 对象名称
```obj
[name]
`雷击特效`               # 使用反引号包围字符串
```

#### [width] - 对象宽度
```obj
[width]
50                       # 数值，影响碰撞检测范围
```

#### [layer] - 图层设置
```obj
[layer]
`[bottom]`               # 底层
`[normal]`               # 普通层（默认）
`[cover]`                # 覆盖层
```

#### [layer level] - 图层级别
```obj
[layer level]
0                        # 数值，同层内的显示优先级
```

### 行为控制标签

#### [pass type] - 通过类型
```obj
[pass type]
`[pass all]`             # 所有单位可通过
`[do not pass]`          # 所有单位不可通过
`[pass friend]`          # 仅友方可通过
`[pass enemy]`           # 仅敌方可通过
```

#### [piercing power] - 穿刺力
```obj
[piercing power]
1000                     # 穿刺力值，影响穿透能力
```

#### [hp] - 生命值
```obj
[hp]
100                      # 对象生命值
```

### 动画和动作标签

#### [basic action] - 基础动作
```obj
[basic action]
`Action/thunder_strike.act`    # ACT文件路径
```

#### [animation] - 动画文件
```obj
[animation]
`Animation/effect.ani`         # ANI文件路径（较少使用）
```

### 攻击和伤害标签

#### [attack info] - 攻击信息
```obj
[attack info]
`AttackInfo/lightning.atk`     # ATK文件路径
```

#### [team] - 队伍归属
```obj
[team]
`[enemy]`                      # 敌方
`[friend]`                     # 友方
`[neutral]`                    # 中立
```

### 销毁条件标签

#### [object destroy condition] - 销毁条件
```obj
[object destroy condition]
`[destroy condition]`
`[on end of animation]`        # 动画结束时销毁
`[/destroy condition]`

`[destroy condition]`
`[on time]`                    # 定时销毁
1000                           # 毫秒
`[/destroy condition]`
[/object destroy condition]
```

### 特殊效果标签

#### [vanish] - 消失设置
```obj
[vanish]
`[on collision]`               # 碰撞时消失
```

#### [category] - 分类
```obj
[category]
`[passive object]`             # 被动对象分类
```

## 📐 语法规则

### 字符串格式
```obj
# ✅ 正确：使用反引号
[name]
`正确的字符串`

# ❌ 错误：使用双引号
[name]
"错误的字符串"                 # 会导致游戏崩溃！
```

### 缩进规范
```obj
# ✅ 正确：使用Tab缩进
[object destroy condition]
	`[destroy condition]`
	`[on end of animation]`
	`[/destroy condition]`
[/object destroy condition]

# ❌ 错误：使用空格缩进
[object destroy condition]
    `[destroy condition]`      # 空格缩进可能导致解析错误
    `[on end of animation]`
    `[/destroy condition]`
[/object destroy condition]
```

### 注释格式
```obj
# 这是单行注释

[name]                         # 行尾注释
`测试对象`

/*
这是多行注释
可以跨越多行
*/
```

## 🔄 标签组合示例

### 简单特效对象
```obj
#PVF_File

[name]
`简单特效`

[width]
30

[layer]
`[normal]`

[pass type]
`[pass all]`

[basic action]
`Action/simple_effect.act`

[object destroy condition]
	`[destroy condition]`
	`[on end of animation]`
	`[/destroy condition]`
[/object destroy condition]
```

### 攻击类对象
```obj
#PVF_File

[name]
`火球术`

[width]
40

[layer]
`[normal]`

[pass type]
`[pass enemy]`

[piercing power]
500

[team]
`[friend]`

[basic action]
`Action/fireball.act`

[attack info]
`AttackInfo/fireball_damage.atk`

[vanish]
`[on collision]`

[object destroy condition]
	`[destroy condition]`
	`[on collision]`
	`[/destroy condition]`
	
	`[destroy condition]`
	`[on time]`
	5000                       # 5秒后自动销毁
	`[/destroy condition]`
[/object destroy condition]
```

### 陷阱类对象
```obj
#PVF_File

[name]
`地刺陷阱`

[width]
60

[layer]
`[bottom]`

[pass type]
`[do not pass]`

[hp]
1                              # 一次性陷阱

[basic action]
`Action/spike_trap.act`

[attack info]
`AttackInfo/spike_damage.atk`

[object destroy condition]
	`[destroy condition]`
	`[on hp]`                  # HP归零时销毁
	`[/destroy condition]`
[/object destroy condition]
```

## ⚠️ 常见错误

### 格式错误
1. **字符串使用双引号**：必须使用反引号 \`\`
2. **缺少文件头**：必须以 `#PVF_File` 开头
3. **标签不匹配**：开始和结束标签必须配对
4. **缩进错误**：使用Tab而不是空格

### 逻辑错误
1. **文件路径错误**：引用的ACT/ATK文件不存在
2. **参数超范围**：数值超出合理范围
3. **标签冲突**：互相矛盾的设置
4. **缺少必需标签**：如缺少 [name] 标签

## 🔧 验证方法

### 语法检查
1. 使用格式检查工具验证语法
2. 检查所有字符串是否使用反引号
3. 验证标签配对和缩进

### 功能测试
1. 在游戏中创建对象测试
2. 检查动画和特效是否正常
3. 验证交互和销毁逻辑

### 性能测试
1. 测试大量对象同时存在的情况
2. 检查内存和CPU使用情况
3. 优化复杂的销毁条件

---

*下一步：学习 [依赖关系](依赖关系.md)*