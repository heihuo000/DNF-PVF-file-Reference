# OBJæ–‡ä»¶æ€§èƒ½ä¼˜åŒ–æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

OBJæ–‡ä»¶çš„æ€§èƒ½ä¼˜åŒ–å¯¹äºæ¸¸æˆæµç•…åº¦è‡³å…³é‡è¦ã€‚æœ¬æ–‡æ¡£æä¾›äº†å…¨é¢çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥å’ŒæŠ€å·§ã€‚

## ğŸ¯ ä¼˜åŒ–åŸåˆ™

### 1. å‡å°‘å¯¹è±¡æ•°é‡
```obj
# âŒ é”™è¯¯ï¼šåˆ›å»ºè¿‡å¤šå°å¯¹è±¡
[name] `effect_spark_01`
[width] 10
[layer] `[normal]`
[basic action] `Action/spark_small.act`

[name] `effect_spark_02`
[width] 10
[layer] `[normal]`
[basic action] `Action/spark_small.act`

# âœ… æ­£ç¡®ï¼šåˆå¹¶ä¸ºå•ä¸ªå¯¹è±¡
[name] `effect_spark_combined`
[width] 50
[layer] `[normal]`
[basic action] `Action/spark_combined.act`
```

### 2. ä¼˜åŒ–ç”Ÿå‘½å‘¨æœŸ
```obj
# âŒ é”™è¯¯ï¼šæ— é™ç”Ÿå­˜æ—¶é—´
[name] `persistent_effect`
[width] 100
[layer] `[normal]`
[basic action] `Action/persistent.act`
# æ²¡æœ‰é”€æ¯æ¡ä»¶

# âœ… æ­£ç¡®ï¼šè®¾ç½®åˆç†çš„é”€æ¯æ¡ä»¶
[name] `timed_effect`
[width] 100
[layer] `[normal]`
[basic action] `Action/timed.act`
[object destroy condition]
	`time`	3000	# 3ç§’åè‡ªåŠ¨é”€æ¯
[/object destroy condition]
```

## ğŸ”§ å…·ä½“ä¼˜åŒ–æŠ€å·§

### 1. å±‚çº§ä¼˜åŒ–

#### åˆç†ä½¿ç”¨å±‚çº§
```obj
# èƒŒæ™¯æ•ˆæœä½¿ç”¨åº•å±‚
[name] `background_glow`
[layer] `[bottom]`
[layer level] 1

# ä¸»è¦æ•ˆæœä½¿ç”¨æ™®é€šå±‚
[name] `main_effect`
[layer] `[normal]`
[layer level] 50

# é‡è¦æç¤ºä½¿ç”¨è¦†ç›–å±‚
[name] `critical_warning`
[layer] `[cover]`
[layer level] 100
```

#### é¿å…å±‚çº§å†²çª
```obj
# âŒ é”™è¯¯ï¼šç›¸åŒå±‚çº§å¯¼è‡´æ¸²æŸ“å†²çª
[name] `effect_a`
[layer] `[normal]`
[layer level] 50

[name] `effect_b`
[layer] `[normal]`
[layer level] 50

# âœ… æ­£ç¡®ï¼šé”™å¼€å±‚çº§
[name] `effect_a`
[layer] `[normal]`
[layer level] 49

[name] `effect_b`
[layer] `[normal]`
[layer level] 51
```

### 2. å°ºå¯¸ä¼˜åŒ–

#### æœ€å°åŒ–ç¢°æ’æ£€æµ‹èŒƒå›´
```obj
# âŒ é”™è¯¯ï¼šè¿‡å¤§çš„ç¢°æ’èŒƒå›´
[name] `small_projectile`
[width] 200	# å®é™…åªéœ€è¦20
[height] 200

# âœ… æ­£ç¡®ï¼šç²¾ç¡®çš„ç¢°æ’èŒƒå›´
[name] `small_projectile`
[width] 20
[height] 20
```

#### åŠ¨æ€è°ƒæ•´å°ºå¯¸
```obj
# æ ¹æ®æ•ˆæœé˜¶æ®µè°ƒæ•´å°ºå¯¸
[name] `expanding_blast`
[width] 50	# åˆå§‹å°ºå¯¸
[height] 50
[basic action] `Action/expanding_blast.act`	# ACTæ–‡ä»¶ä¸­å¤„ç†å°ºå¯¸å˜åŒ–
```

### 3. åŠ¨ä½œä¼˜åŒ–

#### å‡å°‘åŠ¨ç”»å¸§æ•°
```obj
# âŒ é”™è¯¯ï¼šè¿‡å¤šåŠ¨ç”»å¸§
[basic action] `Action/detailed_effect.act`	# 60å¸§åŠ¨ç”»

# âœ… æ­£ç¡®ï¼šä¼˜åŒ–åçš„åŠ¨ç”»
[basic action] `Action/optimized_effect.act`	# 30å¸§åŠ¨ç”»ï¼Œè§†è§‰æ•ˆæœç›¸è¿‘
```

#### ä½¿ç”¨å¾ªç¯åŠ¨ç”»
```obj
# å¾ªç¯æ’­æ”¾å‡å°‘å†…å­˜å ç”¨
[name] `looping_aura`
[basic action] `Action/aura_loop.act`	# çŸ­å¾ªç¯åŠ¨ç”»
[object destroy condition]
	`time`	5000	# 5ç§’åé”€æ¯
[/object destroy condition]
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### 1. å¯¹è±¡è®¡æ•°ç›‘æ§
```python
# Pythonè„šæœ¬ï¼šç›‘æ§OBJå¯¹è±¡æ•°é‡
import re
import os

def count_obj_files(directory):
    """ç»Ÿè®¡ç›®å½•ä¸­çš„OBJæ–‡ä»¶æ•°é‡"""
    obj_count = 0
    for root, dirs, files in os.walk(directory):
        for file in files:
            if file.endswith('.obj'):
                obj_count += 1
    return obj_count

def analyze_obj_complexity(file_path):
    """åˆ†æå•ä¸ªOBJæ–‡ä»¶çš„å¤æ‚åº¦"""
    with open(file_path, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # ç»Ÿè®¡æ ‡ç­¾æ•°é‡
    tag_count = len(re.findall(r'\[.*?\]', content))
    
    # æ£€æŸ¥æ˜¯å¦æœ‰é”€æ¯æ¡ä»¶
    has_destroy_condition = 'object destroy condition' in content
    
    # æ£€æŸ¥åŠ¨ä½œæ–‡ä»¶å¼•ç”¨
    action_refs = re.findall(r'Action/.*?\.act', content)
    
    return {
        'tag_count': tag_count,
        'has_destroy_condition': has_destroy_condition,
        'action_references': len(action_refs)
    }

# ä½¿ç”¨ç¤ºä¾‹
directory = "passiveobject/"
total_objs = count_obj_files(directory)
print(f"æ€»OBJæ–‡ä»¶æ•°é‡: {total_objs}")
```

### 2. å†…å­˜ä½¿ç”¨åˆ†æ
```python
# å†…å­˜ä½¿ç”¨ä¼°ç®—è„šæœ¬
def estimate_memory_usage(obj_file):
    """ä¼°ç®—OBJæ–‡ä»¶çš„å†…å­˜ä½¿ç”¨"""
    with open(obj_file, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # åŸºç¡€å†…å­˜å ç”¨
    base_memory = 1024  # 1KBåŸºç¡€
    
    # æ ¹æ®å®½é«˜è®¡ç®—
    width_match = re.search(r'\[width\]\s*(\d+)', content)
    height_match = re.search(r'\[height\]\s*(\d+)', content)
    
    if width_match and height_match:
        width = int(width_match.group(1))
        height = int(height_match.group(1))
        collision_memory = (width * height) // 100  # ç®€åŒ–è®¡ç®—
    else:
        collision_memory = 0
    
    # åŠ¨ä½œæ–‡ä»¶å†…å­˜
    action_count = len(re.findall(r'Action/.*?\.act', content))
    action_memory = action_count * 2048  # æ¯ä¸ªåŠ¨ä½œçº¦2KB
    
    total_memory = base_memory + collision_memory + action_memory
    return total_memory

# æ‰¹é‡åˆ†æ
def analyze_directory_memory(directory):
    """åˆ†æç›®å½•å†…å­˜ä½¿ç”¨"""
    total_memory = 0
    file_count = 0
    
    for root, dirs, files in os.walk(directory):
        for file in files:
            if file.endswith('.obj'):
                file_path = os.path.join(root, file)
                memory = estimate_memory_usage(file_path)
                total_memory += memory
                file_count += 1
                print(f"{file}: {memory} bytes")
    
    print(f"\næ€»è®¡: {file_count} ä¸ªæ–‡ä»¶, {total_memory} bytes ({total_memory/1024:.2f} KB)")
```

## âš¡ é«˜çº§ä¼˜åŒ–æŠ€å·§

### 1. å¯¹è±¡æ± åŒ–
```obj
# åˆ›å»ºå¯é‡ç”¨çš„é€šç”¨æ•ˆæœå¯¹è±¡
[name] `generic_explosion`
[width] 100
[height] 100
[layer] `[normal]`
[basic action] `Action/generic_explosion.act`
[object destroy condition]
	`time`	2000
[/object destroy condition]

# é€šè¿‡å‚æ•°æ§åˆ¶ä¸åŒæ•ˆæœ
[category] `reusable_effect`	# æ ‡è®°ä¸ºå¯é‡ç”¨
```

### 2. å»¶è¿ŸåŠ è½½
```obj
# æ ‡è®°ä¸ºå»¶è¿ŸåŠ è½½çš„å¯¹è±¡
[name] `heavy_effect`
[width] 200
[height] 200
[layer] `[normal]`
[basic action] `Action/heavy_effect.act`
[category] `lazy_load`	# éœ€è¦æ—¶æ‰åŠ è½½
```

### 3. LODï¼ˆç»†èŠ‚å±‚æ¬¡ï¼‰ç³»ç»Ÿ
```obj
# é«˜è´¨é‡ç‰ˆæœ¬ï¼ˆè¿‘è·ç¦»ï¼‰
[name] `effect_high_lod`
[width] 100
[height] 100
[basic action] `Action/effect_detailed.act`

# ä½è´¨é‡ç‰ˆæœ¬ï¼ˆè¿œè·ç¦»ï¼‰
[name] `effect_low_lod`
[width] 100
[height] 100
[basic action] `Action/effect_simple.act`
```

## ğŸ” æ€§èƒ½æµ‹è¯•

### 1. å‹åŠ›æµ‹è¯•è„šæœ¬
```python
# æ€§èƒ½å‹åŠ›æµ‹è¯•
import time
import psutil
import subprocess

def performance_test(obj_directory):
    """æ‰§è¡Œæ€§èƒ½æµ‹è¯•"""
    print("å¼€å§‹æ€§èƒ½æµ‹è¯•...")
    
    # è®°å½•åˆå§‹çŠ¶æ€
    initial_memory = psutil.virtual_memory().used
    start_time = time.time()
    
    # æ¨¡æ‹ŸåŠ è½½æ‰€æœ‰OBJæ–‡ä»¶
    obj_files = []
    for root, dirs, files in os.walk(obj_directory):
        for file in files:
            if file.endswith('.obj'):
                obj_files.append(os.path.join(root, file))
    
    print(f"æ‰¾åˆ° {len(obj_files)} ä¸ªOBJæ–‡ä»¶")
    
    # æ¨¡æ‹Ÿå¤„ç†
    for obj_file in obj_files:
        with open(obj_file, 'r', encoding='utf-8') as f:
            content = f.read()
        # æ¨¡æ‹Ÿè§£æå¤„ç†
        time.sleep(0.001)  # æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
    
    # è®°å½•ç»“æŸçŠ¶æ€
    end_time = time.time()
    final_memory = psutil.virtual_memory().used
    
    print(f"å¤„ç†æ—¶é—´: {end_time - start_time:.2f} ç§’")
    print(f"å†…å­˜å¢é•¿: {(final_memory - initial_memory) / 1024 / 1024:.2f} MB")

# è¿è¡Œæµ‹è¯•
performance_test("passiveobject/")
```

### 2. è‡ªåŠ¨åŒ–ä¼˜åŒ–å»ºè®®
```python
def generate_optimization_report(obj_file):
    """ç”Ÿæˆä¼˜åŒ–å»ºè®®æŠ¥å‘Š"""
    with open(obj_file, 'r', encoding='utf-8') as f:
        content = f.read()
    
    suggestions = []
    
    # æ£€æŸ¥é”€æ¯æ¡ä»¶
    if 'object destroy condition' not in content:
        suggestions.append("å»ºè®®æ·»åŠ é”€æ¯æ¡ä»¶ä»¥é¿å…å†…å­˜æ³„æ¼")
    
    # æ£€æŸ¥å°ºå¯¸
    width_match = re.search(r'\[width\]\s*(\d+)', content)
    if width_match and int(width_match.group(1)) > 500:
        suggestions.append("å¯¹è±¡å®½åº¦è¿‡å¤§ï¼Œè€ƒè™‘å‡å°ä»¥æé«˜æ€§èƒ½")
    
    # æ£€æŸ¥å±‚çº§
    if '[layer level]' not in content:
        suggestions.append("å»ºè®®æ˜ç¡®æŒ‡å®šå±‚çº§ä»¥é¿å…æ¸²æŸ“å†²çª")
    
    return suggestions

# æ‰¹é‡ç”ŸæˆæŠ¥å‘Š
def batch_optimization_report(directory):
    """æ‰¹é‡ç”Ÿæˆä¼˜åŒ–æŠ¥å‘Š"""
    for root, dirs, files in os.walk(directory):
        for file in files:
            if file.endswith('.obj'):
                file_path = os.path.join(root, file)
                suggestions = generate_optimization_report(file_path)
                if suggestions:
                    print(f"\n{file}:")
                    for suggestion in suggestions:
                        print(f"  - {suggestion}")
```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

### æ¨èæŒ‡æ ‡
- **å•ä¸ªOBJæ–‡ä»¶å¤§å°**: < 2KB
- **å¯¹è±¡ç”Ÿå­˜æ—¶é—´**: < 10ç§’
- **åŒæ—¶å­˜åœ¨å¯¹è±¡æ•°**: < 50ä¸ª
- **ç¢°æ’æ£€æµ‹èŒƒå›´**: å°½å¯èƒ½å°
- **åŠ¨ç”»å¸§æ•°**: < 30å¸§

### æ€§èƒ½ç­‰çº§
| ç­‰çº§ | å¯¹è±¡æ•°é‡ | å†…å­˜ä½¿ç”¨ | å¤„ç†æ—¶é—´ |
|------|----------|----------|----------|
| ä¼˜ç§€ | < 20 | < 10MB | < 0.1s |
| è‰¯å¥½ | 20-50 | 10-25MB | 0.1-0.3s |
| ä¸€èˆ¬ | 50-100 | 25-50MB | 0.3-0.5s |
| éœ€ä¼˜åŒ– | > 100 | > 50MB | > 0.5s |

## ğŸš¨ å¸¸è§æ€§èƒ½é—®é¢˜

### 1. å†…å­˜æ³„æ¼
```obj
# é—®é¢˜ï¼šæ²¡æœ‰é”€æ¯æ¡ä»¶
[name] `permanent_effect`
[basic action] `Action/loop.act`

# è§£å†³ï¼šæ·»åŠ é”€æ¯æ¡ä»¶
[name] `timed_effect`
[basic action] `Action/loop.act`
[object destroy condition]
	`time`	5000
[/object destroy condition]
```

### 2. è¿‡åº¦æ¸²æŸ“
```obj
# é—®é¢˜ï¼šå±‚çº§æ··ä¹±
[layer] `[cover]`	# ä¸å¿…è¦çš„è¦†ç›–å±‚

# è§£å†³ï¼šä½¿ç”¨åˆé€‚å±‚çº§
[layer] `[normal]`
[layer level] 10
```

### 3. ç¢°æ’æ£€æµ‹å¼€é”€
```obj
# é—®é¢˜ï¼šè¿‡å¤§çš„ç¢°æ’èŒƒå›´
[width] 1000
[height] 1000

# è§£å†³ï¼šç²¾ç¡®çš„ç¢°æ’èŒƒå›´
[width] 50
[height] 50
```

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å®šæœŸæ€§èƒ½å®¡æŸ¥**: æ¯æœˆæ£€æŸ¥ä¸€æ¬¡OBJæ–‡ä»¶æ€§èƒ½
2. **ä½¿ç”¨æ€§èƒ½å·¥å…·**: åˆ©ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ç›‘æ§æ€§èƒ½
3. **æ¸è¿›å¼ä¼˜åŒ–**: ä¼˜å…ˆä¼˜åŒ–å½±å“æœ€å¤§çš„æ–‡ä»¶
4. **æµ‹è¯•éªŒè¯**: æ¯æ¬¡ä¼˜åŒ–åè¿›è¡Œæ€§èƒ½æµ‹è¯•
5. **æ–‡æ¡£è®°å½•**: è®°å½•ä¼˜åŒ–è¿‡ç¨‹å’Œæ•ˆæœ

## ğŸ”— ç›¸å…³èµ„æº

- [OBJæ–‡ä»¶æ¦‚è¿°](../01-åŸºç¡€ä¿¡æ¯/OBJæ–‡ä»¶æ¦‚è¿°.md)
- [è°ƒè¯•æŠ€å·§](../04-å¸¸è§é—®é¢˜/è°ƒè¯•æŠ€å·§.md)
- [æ ¼å¼æ£€æŸ¥å·¥å…·](../05-å®ç”¨å·¥å…·/æ ¼å¼æ£€æŸ¥å·¥å…·.md)
- [PVFæ–‡ä»¶æ ¼å¼è§„èŒƒ](../../PVFæ–‡ä»¶æ ¼å¼è§„èŒƒ.md)