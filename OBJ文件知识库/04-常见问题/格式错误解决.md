# OBJ文件格式错误解决

## 🚨 常见格式错误

### 字符串格式错误

#### 问题：使用双引号而非反引号
```obj
# ❌ 错误写法
[name]
"错误的字符串"

# ✅ 正确写法
[name]
`正确的字符串`
```

**错误现象**：
- 游戏启动时崩溃
- 对象无法正常加载
- 出现解析错误提示

**解决方法**：
1. 检查所有字符串是否使用反引号 \`\`
2. 使用查找替换功能：将 `"` 替换为 \`
3. 使用格式检查工具验证

### 缩进格式错误

#### 问题：使用空格而非Tab缩进
```obj
# ❌ 错误写法（空格缩进）
[object destroy condition]
    `[destroy condition]`
    `[on end of animation]`
    `[/destroy condition]`
[/object destroy condition]

# ✅ 正确写法（Tab缩进）
[object destroy condition]
	`[destroy condition]`
	`[on end of animation]`
	`[/destroy condition]`
[/object destroy condition]
```

**错误现象**：
- 标签嵌套解析失败
- 功能不生效
- 游戏加载错误

**解决方法**：
1. 设置编辑器显示空白字符
2. 将所有缩进替换为Tab
3. 使用支持PVF格式的编辑器

### 文件头缺失

#### 问题：缺少 #PVF_File 标识
```obj
# ❌ 错误写法（缺少文件头）
[name]
`测试对象`

# ✅ 正确写法（包含文件头）
#PVF_File

[name]
`测试对象`
```

**错误现象**：
- 文件无法被识别为PVF格式
- 加载时被忽略
- 功能完全不生效

**解决方法**：
1. 在文件开头添加 `#PVF_File`
2. 确保文件头前没有其他内容
3. 检查文件编码格式

## 🔧 标签配对错误

### 开始和结束标签不匹配

#### 问题：标签配对错误
```obj
# ❌ 错误写法
[object destroy condition]
	`[destroy condition]`
	`[on end of animation]`
	`[/destroy condition]`
# 缺少结束标签

# ✅ 正确写法
[object destroy condition]
	`[destroy condition]`
	`[on end of animation]`
	`[/destroy condition]`
[/object destroy condition]
```

**错误现象**：
- 解析器无法正确识别标签结构
- 后续标签可能被错误解析
- 功能异常或不生效

**解决方法**：
1. 检查每个开始标签都有对应的结束标签
2. 确保标签名称完全一致
3. 注意标签的嵌套层级

### 标签名称错误

#### 问题：标签名称拼写错误
```obj
# ❌ 错误写法
[naem]                       # name拼写错误
`测试对象`

[widht]                      # width拼写错误
50

# ✅ 正确写法
[name]
`测试对象`

[width]
50
```

**错误现象**：
- 标签被忽略
- 默认值被使用
- 功能不符合预期

**解决方法**：
1. 对照标签参考文档检查拼写
2. 使用代码编辑器的语法检查功能
3. 参考正确的示例文件

## 📁 文件路径错误

### 路径分隔符错误

#### 问题：使用Windows路径分隔符
```obj
# ❌ 错误写法
[basic action]
`Action\effect.act`          # 使用反斜杠

# ✅ 正确写法
[basic action]
`Action/effect.act`          # 使用正斜杠
```

**错误现象**：
- 文件无法找到
- 动画或攻击效果不生效
- 加载错误提示

**解决方法**：
1. 统一使用正斜杠 `/` 作为路径分隔符
2. 检查所有文件路径引用
3. 确保路径相对于PVF根目录

### 文件不存在

#### 问题：引用的文件不存在
```obj
[basic action]
`Action/nonexistent.act`     # 文件不存在

[attack info]
`AttackInfo/missing.atk`     # 文件不存在
```

**错误现象**：
- 对象创建但无动画
- 攻击无效果
- 游戏日志显示文件未找到

**解决方法**：
1. 检查引用的文件是否存在
2. 验证文件路径是否正确
3. 创建缺失的文件或修改引用

## 🔢 数值范围错误

### 超出有效范围

#### 问题：数值超出合理范围
```obj
# ❌ 可能有问题的写法
[width]
-10                          # 负数宽度

[piercing power]
999999999                    # 过大的穿刺力

# ✅ 合理的写法
[width]
50                           # 正数宽度

[piercing power]
1000                         # 合理的穿刺力
```

**错误现象**：
- 游戏行为异常
- 性能问题
- 可能导致崩溃

**解决方法**：
1. 参考官方示例的数值范围
2. 进行游戏内测试验证
3. 逐步调整到合理范围

## 🛠️ 调试工具和方法

### 使用格式检查工具

#### 自动检查脚本
```batch
@echo off
echo 检查OBJ文件格式...

# 检查双引号
findstr /n "\"" *.obj
if %errorlevel% equ 0 (
    echo 发现双引号，请替换为反引号
)

# 检查文件头
findstr /n "#PVF_File" *.obj
if %errorlevel% neq 0 (
    echo 缺少文件头 #PVF_File
)

echo 检查完成
pause
```

### 手动检查清单

#### 基础格式检查
- [ ] 文件以 `#PVF_File` 开头
- [ ] 所有字符串使用反引号 \`\`
- [ ] 缩进使用Tab而非空格
- [ ] 标签配对正确
- [ ] 文件路径使用正斜杠

#### 内容检查
- [ ] 必需标签 [name] 存在
- [ ] 引用的文件路径正确
- [ ] 数值在合理范围内
- [ ] 标签名称拼写正确

### 分步调试法

#### 第一步：最小配置测试
```obj
#PVF_File

[name]
`测试对象`

[width]
30

[layer]
`[normal]`

[pass type]
`[pass all]`
```

#### 第二步：添加动画
```obj
# 在最小配置基础上添加
[basic action]
`Action/test.act`
```

#### 第三步：添加销毁条件
```obj
# 继续添加功能
[object destroy condition]
	`[destroy condition]`
	`[on end of animation]`
	`[/destroy condition]`
[/object destroy condition]
```

## 📋 错误日志分析

### 常见错误信息

#### "Parse Error"
- **原因**：语法格式错误
- **解决**：检查标签配对和字符串格式

#### "File Not Found"
- **原因**：引用的文件不存在
- **解决**：检查文件路径和文件存在性

#### "Invalid Tag"
- **原因**：标签名称错误或不支持
- **解决**：对照文档检查标签名称

#### "Value Out of Range"
- **原因**：数值超出有效范围
- **解决**：调整数值到合理范围

### 日志查看方法
1. 启用游戏调试模式
2. 查看游戏安装目录的日志文件
3. 搜索与OBJ文件相关的错误信息
4. 根据错误信息定位问题

## 🔄 预防措施

### 开发规范
1. **使用模板**：基于正确的模板创建新文件
2. **定期检查**：使用自动化工具定期检查格式
3. **版本控制**：保留工作正常的版本作为备份
4. **测试验证**：每次修改后进行游戏内测试

### 工具配置
1. **编辑器设置**：配置显示空白字符
2. **语法高亮**：使用支持PVF格式的编辑器
3. **自动检查**：集成格式检查到开发流程
4. **备份机制**：定期备份重要文件

---

*下一步：查看 [效果不生效](效果不生效.md) 解决方案*