# STK数值计算器

## 📋 概述

本文档提供STK文件中各种数值的计算方法和工具，帮助开发者设计平衡的游戏数值。

## 🧮 基础数值计算

### 等级与属性关系
```python
def calculate_base_stats(level):
    """根据等级计算基础属性推荐值"""
    base_hp = level * 15 + 100
    base_mp = level * 10 + 50
    base_attack = level * 3 + 10
    base_defense = level * 2 + 5
    
    return {
        'hp': base_hp,
        'mp': base_mp,
        'attack': base_attack,
        'defense': base_defense
    }

# 示例使用
level_30_stats = calculate_base_stats(30)
print(f"30级推荐属性: {level_30_stats}")
# 输出: 30级推荐属性: {'hp': 550, 'mp': 350, 'attack': 100, 'defense': 65}
```

### 价格计算公式
```python
def calculate_item_price(level, rarity, item_type):
    """计算物品价格"""
    # 基础价格
    base_price = level * 100
    
    # 稀有度倍数
    rarity_multiplier = {
        1: 1.0,    # 普通
        2: 1.5,    # 高级
        3: 2.5,    # 稀有
        4: 4.0,    # 史诗
        5: 7.0,    # 传说
        6: 12.0    # 神器
    }
    
    # 类型倍数
    type_multiplier = {
        'consumable': 1.0,
        'material': 0.8,
        'booster': 3.0,
        'recipe': 2.0,
        'throw item': 1.5,
        'pandora box': 5.0,
        'legacy': 8.0,
        'quest': 0.0
    }
    
    price = base_price * rarity_multiplier.get(rarity, 1.0) * type_multiplier.get(item_type, 1.0)
    return int(price)

# 示例计算
price = calculate_item_price(level=35, rarity=3, item_type='consumable')
print(f"35级稀有消耗品建议价格: {price}")
# 输出: 35级稀有消耗品建议价格: 8750
```

### 回收价值计算
```python
def calculate_sell_value(buy_price, rarity):
    """计算回收价值"""
    # 基础回收率
    base_rate = 0.5
    
    # 稀有度调整
    rarity_adjustment = {
        1: 0.4,    # 普通物品回收率低
        2: 0.45,   # 高级
        3: 0.5,    # 稀有
        4: 0.55,   # 史诗
        5: 0.6,    # 传说
        6: 0.65    # 神器回收率高
    }
    
    rate = rarity_adjustment.get(rarity, base_rate)
    return int(buy_price * rate)

# 示例计算
sell_value = calculate_sell_value(buy_price=10000, rarity=4)
print(f"史诗物品回收价值: {sell_value}")
# 输出: 史诗物品回收价值: 5500
```

## ⚖️ 平衡性计算

### 消耗品效果计算
```python
def calculate_consumable_effect(level, duration_seconds=0):
    """计算消耗品效果数值"""
    if duration_seconds == 0:
        # 瞬间恢复类
        hp_restore = level * 20 + 100
        mp_restore = level * 15 + 50
    else:
        # 持续效果类
        duration_minutes = duration_seconds / 60000
        total_effect = level * 10 + 50
        hp_restore = int(total_effect / max(1, duration_minutes))
        mp_restore = int(hp_restore * 0.8)
    
    return {
        'hp_restore': hp_restore,
        'mp_restore': mp_restore,
        'suggested_cooldown': max(3000, duration_seconds // 2)
    }

# 示例计算
instant_potion = calculate_consumable_effect(level=40)
buff_potion = calculate_consumable_effect(level=40, duration_seconds=300000)  # 5分钟

print(f"40级瞬间药水: {instant_potion}")
print(f"40级增益药水: {buff_potion}")
```

### 属性增强计算
```python
def calculate_stat_boost(base_stat, level, duration_seconds):
    """计算属性增强数值"""
    # 基础增强比例（根据持续时间调整）
    duration_minutes = duration_seconds / 60000
    
    if duration_minutes <= 5:
        boost_percentage = 0.3  # 短期高效果
    elif duration_minutes <= 15:
        boost_percentage = 0.2  # 中期中效果
    else:
        boost_percentage = 0.15  # 长期低效果
    
    # 等级调整
    level_factor = 1 + (level - 1) * 0.02
    
    boost_value = int(base_stat * boost_percentage * level_factor)
    return boost_value

# 示例计算
strength_boost = calculate_stat_boost(base_stat=100, level=35, duration_seconds=600000)
print(f"35级力量增强效果: +{strength_boost}")
```

## 🎲 概率计算

### 抽奖概率设计
```python
def design_lottery_rates(total_items, rare_items, epic_items, legend_items):
    """设计抽奖概率"""
    # 总概率为100000（万分比）
    total_rate = 100000
    
    # 传说物品概率（通常0.1-1%）
    legend_rate = max(100, total_rate // (total_items * 20))
    
    # 史诗物品概率（通常1-5%）
    epic_rate = max(500, total_rate // (total_items * 4))
    
    # 稀有物品概率（通常5-15%）
    rare_rate = max(2000, total_rate // (total_items * 2))
    
    # 普通物品概率（剩余概率）
    normal_rate = total_rate - (legend_rate * legend_items + 
                               epic_rate * epic_items + 
                               rare_rate * rare_items)
    
    return {
        'legend_rate': legend_rate,
        'epic_rate': epic_rate,
        'rare_rate': rare_rate,
        'normal_rate': normal_rate,
        'total_check': legend_rate * legend_items + epic_rate * epic_items + 
                      rare_rate * rare_items + normal_rate
    }

# 示例设计
lottery_design = design_lottery_rates(
    total_items=10, rare_items=3, epic_items=2, legend_items=1
)
print(f"抽奖概率设计: {lottery_design}")
```

### 成功率计算
```python
def calculate_success_rate(base_rate, enhancement_level, item_rarity):
    """计算强化成功率"""
    # 基础成功率
    success_rate = base_rate
    
    # 强化等级影响
    level_penalty = enhancement_level * 5  # 每级降低5%
    success_rate -= level_penalty
    
    # 稀有度影响
    rarity_bonus = {
        1: 0,    # 普通无加成
        2: 5,    # 高级+5%
        3: 10,   # 稀有+10%
        4: 15,   # 史诗+15%
        5: 20,   # 传说+20%
        6: 25    # 神器+25%
    }
    
    success_rate += rarity_bonus.get(item_rarity, 0)
    
    # 确保在合理范围内
    return max(5, min(95, success_rate))

# 示例计算
success_rate = calculate_success_rate(
    base_rate=80, enhancement_level=7, item_rarity=4
)
print(f"史诗装备+7成功率: {success_rate}%")
```

## 📊 经济平衡计算

### 通胀控制计算
```python
def calculate_inflation_control(current_price, market_supply, market_demand):
    """计算通胀控制价格"""
    # 供需比例
    supply_demand_ratio = market_supply / max(1, market_demand)
    
    # 价格调整因子
    if supply_demand_ratio > 1.5:
        # 供过于求，降价
        adjustment_factor = 0.8
    elif supply_demand_ratio < 0.7:
        # 供不应求，涨价
        adjustment_factor = 1.2
    else:
        # 平衡状态
        adjustment_factor = 1.0
    
    adjusted_price = int(current_price * adjustment_factor)
    return adjusted_price

# 示例计算
new_price = calculate_inflation_control(
    current_price=1000, market_supply=150, market_demand=100
)
print(f"调整后价格: {new_price}")
```

### 金币产出计算
```python
def calculate_gold_generation(player_level, activity_type, time_minutes):
    """计算金币产出"""
    # 基础产出率（每分钟）
    base_rate = player_level * 10
    
    # 活动类型倍数
    activity_multiplier = {
        'dungeon': 1.5,
        'quest': 1.0,
        'trade': 0.8,
        'farming': 1.2,
        'pvp': 0.9
    }
    
    multiplier = activity_multiplier.get(activity_type, 1.0)
    total_gold = int(base_rate * multiplier * time_minutes)
    
    return total_gold

# 示例计算
gold_earned = calculate_gold_generation(
    player_level=45, activity_type='dungeon', time_minutes=30
)
print(f"45级玩家30分钟地下城收益: {gold_earned}金币")
```

## 🛠️ 实用计算工具

### 在线计算器HTML
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STK数值计算器</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .calculator { max-width: 600px; margin: 0 auto; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>STK数值计算器</h1>
        
        <div class="form-group">
            <label for="level">物品等级:</label>
            <input type="number" id="level" min="1" max="85" value="30">
        </div>
        
        <div class="form-group">
            <label for="rarity">稀有度:</label>
            <select id="rarity">
                <option value="1">普通</option>
                <option value="2">高级</option>
                <option value="3" selected>稀有</option>
                <option value="4">史诗</option>
                <option value="5">传说</option>
                <option value="6">神器</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="itemType">物品类型:</label>
            <select id="itemType">
                <option value="consumable" selected>消耗品</option>
                <option value="material">材料</option>
                <option value="booster">增强剂</option>
                <option value="recipe">配方</option>
                <option value="throw item">投掷物品</option>
                <option value="pandora box">潘多拉魔盒</option>
                <option value="legacy">传承装备</option>
            </select>
        </div>
        
        <button onclick="calculateValues()">计算数值</button>
        
        <div id="result" class="result" style="display: none;">
            <h3>计算结果:</h3>
            <div id="resultContent"></div>
        </div>
    </div>

    <script>
        function calculateValues() {
            const level = parseInt(document.getElementById('level').value);
            const rarity = parseInt(document.getElementById('rarity').value);
            const itemType = document.getElementById('itemType').value;
            
            // 价格计算
            const basePrice = level * 100;
            const rarityMultiplier = [1.0, 1.5, 2.5, 4.0, 7.0, 12.0][rarity - 1];
            const typeMultiplier = {
                'consumable': 1.0,
                'material': 0.8,
                'booster': 3.0,
                'recipe': 2.0,
                'throw item': 1.5,
                'pandora box': 5.0,
                'legacy': 8.0
            };
            
            const price = Math.floor(basePrice * rarityMultiplier * typeMultiplier[itemType]);
            const sellValue = Math.floor(price * (0.4 + rarity * 0.05));
            
            // 属性计算
            const baseStats = {
                hp: level * 15 + 100,
                mp: level * 10 + 50,
                attack: level * 3 + 10,
                defense: level * 2 + 5
            };
            
            // 显示结果
            const resultContent = `
                <p><strong>建议价格:</strong> ${price.toLocaleString()} 金币</p>
                <p><strong>回收价值:</strong> ${sellValue.toLocaleString()} 金币</p>
                <p><strong>基础属性参考:</strong></p>
                <ul>
                    <li>HP: ${baseStats.hp}</li>
                    <li>MP: ${baseStats.mp}</li>
                    <li>攻击力: ${baseStats.attack}</li>
                    <li>防御力: ${baseStats.defense}</li>
                </ul>
            `;
            
            document.getElementById('resultContent').innerHTML = resultContent;
            document.getElementById('result').style.display = 'block';
        }
    </script>
</body>
</html>
```

### Excel计算表格模板
```
A1: 物品等级    B1: 30
A2: 稀有度      B2: 3
A3: 物品类型    B3: consumable

A5: 计算结果
A6: 基础价格    B6: =B1*100
A7: 稀有度倍数  B7: =CHOOSE(B2,1,1.5,2.5,4,7,12)
A8: 类型倍数    B8: =IF(B3="consumable",1,IF(B3="material",0.8,IF(B3="booster",3,1)))
A9: 最终价格    B9: =B6*B7*B8
A10: 回收价值   B10: =B9*(0.4+B2*0.05)

A12: 属性参考
A13: HP        B13: =B1*15+100
A14: MP        B14: =B1*10+50
A15: 攻击力    B15: =B1*3+10
A16: 防御力    B16: =B1*2+5
```

## 📈 数值平衡建议

### 等级进度曲线
```python
def generate_level_curve(max_level=85):
    """生成等级进度曲线"""
    curve = []
    for level in range(1, max_level + 1):
        # 指数增长曲线
        exp_required = int(100 * (level ** 1.8))
        
        # 属性增长
        hp_growth = level * 15 + 100
        mp_growth = level * 10 + 50
        
        curve.append({
            'level': level,
            'exp_required': exp_required,
            'total_exp': sum(100 * (i ** 1.8) for i in range(1, level)),
            'hp': hp_growth,
            'mp': mp_growth
        })
    
    return curve

# 生成1-85级曲线
level_curve = generate_level_curve()
for i in [1, 10, 20, 30, 40, 50, 60, 70, 80, 85]:
    data = level_curve[i-1]
    print(f"等级{i}: 经验{data['exp_required']}, HP{data['hp']}, MP{data['mp']}")
```

### 稀有度分布建议
```
稀有度    出现概率    价格倍数    属性倍数
普通(1)   60%        1.0x       1.0x
高级(2)   25%        1.5x       1.2x
稀有(3)   10%        2.5x       1.5x
史诗(4)   4%         4.0x       2.0x
传说(5)   1%         7.0x       3.0x
神器(6)   0.1%       12.0x      5.0x
```

## 🔗 相关链接

- [STK文件模板](./STK文件模板.md)
- [检查工具](./STK文件检查工具.md)
- [基础STK类型](../01-基础STK类型/)
- [标签索引](../03-标签索引/)
- [实际示例](../05-实际示例/)

## 💡 使用建议

1. **渐进调整**: 数值调整应该渐进式进行，避免大幅变动
2. **数据驱动**: 基于实际游戏数据进行调整
3. **玩家反馈**: 重视玩家对数值平衡的反馈
4. **定期评估**: 定期评估数值平衡状况
5. **文档记录**: 详细记录每次数值调整的原因和效果