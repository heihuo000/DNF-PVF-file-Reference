# 任务道具STK文件详解

## 📋 概述

任务道具是DNF中专门用于任务系统的STK文件类型，包括任务物品、任务钥匙、任务证明等。

## 🏷️ 基本标签结构

### 物品基本信息
```
[name] `神秘的钥匙`               // 任务道具名称
[name2] `Mysterious Key`          // 英文名称(可选)
[explain]                         // 道具说明开始
`散发着神秘光芒的钥匙
似乎能够打开某个重要的门`
[/explain]                        // 道具说明结束
[flavor text] `命运的钥匙`         // 风味文本
```

### 等级与稀有度
```
[grade] 40                        // 道具等级
[rarity] 2                        // 稀有度
// 任务道具通常有较高稀有度以突出重要性
```

### 重量与限制
```
[weight] 5                        // 重量
[minimum level] 35                // 使用最低等级
[stack limit] 1                   // 堆叠上限 (任务道具通常不可堆叠)
```

## 📦 任务道具类型

### 类型定义
```
[stackable type] `[quest]` 0      // 任务道具类型
```

### 子类型分类
```
[sub type] 1                      // 子类型
```

**任务道具子类型**:
- `0` - 普通任务道具
- `1` - 任务钥匙
- `2` - 任务证明
- `3` - 任务材料
- `4` - 任务收集品
- `5` - 任务触发道具

## 💰 经济属性

### 交易属性
```
[attach type] `[account]`         // 交易类型
// 任务道具通常绑定账号，不可交易
// `[account]` - 账号绑定
// `[sealing]` - 封印状态
// `[trade delete]` - 交易后删除
```

### 价格设定
```
[price] 0                         // 购买价格 (通常为0)
[value] 0                         // 出售价格 (通常为0，防止误售)
[creation rate] 0                 // 生成概率 (通常为0，由任务给予)
```

## 🎯 任务关联

### 任务链接
```
[linking quest index] 1500        // 关联任务ID
// 指定该道具属于哪个任务
```

### 任务数据
```
[int data]                        // 整数数据开始
1500                             // 任务ID
1                                // 任务阶段
0                                // 任务类型 (0:主线 1:支线 2:日常)
[/int data]                      // 整数数据结束

[string data]                     // 字符串数据开始
`main_quest_chapter_5`           // 任务标识
`unlock_dungeon`                 // 功能标识
[/string data]                   // 字符串数据结束
```

## 🔑 特殊功能类型

### 钥匙道具
```
[action type]                     // 功能类型开始
`[key]`                          // 钥匙功能
5001                             // 目标门/箱子ID
1                                // 使用次数 (0=无限次)
[/action type]                   // 功能类型结束

[int data]
5001                             // 目标ID
1                                // 使用次数
0                                // 额外参数
[/int data]
```

### 传送道具
```
[action type]
`[teleport]`                     // 传送功能
10001                            // 目标地图ID
100                              // X坐标
200                              // Y坐标
[/action type]

[int data]
10001                            // 地图ID
100                              // X坐标
200                              // Y坐标
[/int data]
```

### 召唤道具
```
[action type]
`[summon]`                       // 召唤功能
20001                            // 召唤对象ID
1                                // 召唤数量
[/action type]

[int data]
20001                            // 召唤对象ID
1                                // 召唤数量
30000                            // 持续时间(毫秒)
[/int data]
```

## 🎨 视觉与音效

### 图标设定
```
[icon] `QuestIcon.img` 45         // 任务道具图标
[field image] `QuestField.img` 20 // 掉落显示图像
```

### 音效设定
```
[move wav] `QUEST_ITEM_TOUCH`     // 移动音效
[use wav] `QUEST_ITEM_USE`        // 使用音效
```

## 🚫 使用限制

### 使用场所
```
[action usable place]             // 可使用场所开始
`[village]`                      // 城镇
`[dungeon]`                      // 地下城
[/action usable place]           // 使用场所结束
```

### 职业限制
```
[usable job]                      // 可使用职业开始
`[all]`                          // 通常全职业可用
[/usable job]                    // 职业限制结束
```

## 📋 完整示例

### 任务钥匙示例
```
[name] `古代遗迹的钥匙`
[explain]
`打开古代遗迹大门的神秘钥匙
据说里面隐藏着强大的力量`
[grade] 45
[rarity] 3
[attach type] `[account]`
[creation rate] 0
[weight] 3
[usable job]
`[all]`
[/usable job]
[minimum level] 40
[stackable type] `[quest]` 0
[sub type] 1
[icon] `QuestIcon.img` 45
[field image] `QuestField.img` 20
[price] 0
[value] 0
[move wav] `QUEST_ITEM_TOUCH`
[use wav] `KEY_USE`
[stack limit] 1
[linking quest index] 1500
[action type]
`[key]`
5001
1
[/action type]
[action usable place]
`[dungeon]`
[/action usable place]
[int data]
1500
1
0
5001
1
0
[/int data]
[string data]
`main_quest_chapter_5`
`unlock_ancient_ruins`
[/string data]
```

### 任务证明示例
```
[name] `勇者的证明`
[explain]
`证明勇者身份的重要凭证
完成试炼后获得`
[grade] 50
[rarity] 4
[attach type] `[account]`
[creation rate] 0
[weight] 1
[usable job]
`[all]`
[/usable job]
[minimum level] 45
[stackable type] `[quest]` 0
[sub type] 2
[icon] `QuestIcon.img` 50
[field image] `QuestField.img` 25
[price] 0
[value] 0
[move wav] `QUEST_ITEM_TOUCH`
[stack limit] 1
[linking quest index] 1600
[int data]
1600
3
1
[/int data]
[string data]
`hero_trial_quest`
`proof_of_courage`
[/string data]
```

### 任务收集品示例
```
[name] `魔法水晶碎片`
[explain]
`散发着魔法光芒的水晶碎片
收集10个可以合成完整的魔法水晶`
[grade] 30
[rarity] 1
[attach type] `[account]`
[creation rate] 0
[weight] 2
[usable job]
`[all]`
[/usable job]
[minimum level] 25
[stackable type] `[quest]` 0
[sub type] 4
[icon] `QuestIcon.img` 30
[field image] `QuestField.img` 15
[price] 0
[value] 0
[move wav] `CRYSTAL_TOUCH`
[stack limit] 10
[linking quest index] 1400
[int data]
1400
2
2
10
[/int data]
[string data]
`crystal_collection_quest`
`magic_crystal_fragment`
[/string data]
```

## 💡 设计建议

### 功能设计
1. **目的明确**: 清楚定义道具的任务用途
2. **唯一性**: 确保道具在任务中的唯一作用
3. **防误操作**: 设置合适的限制防止误用

### 数值设定
1. **等级匹配**: 道具等级应与任务等级匹配
2. **稀有度合理**: 根据任务重要性设定稀有度
3. **重量适中**: 避免过重影响背包空间

### 用户体验
1. **描述清晰**: 准确描述道具的作用和用法
2. **视觉突出**: 使用醒目的图标和颜色
3. **音效合适**: 选择符合道具特性的音效

### 系统集成
1. **任务关联**: 正确设置任务ID关联
2. **触发条件**: 确保道具能正确触发任务事件
3. **清理机制**: 任务完成后自动清理无用道具

## 🔗 相关链接

- [消耗品详解](消耗品详解.md)
- [材料详解](材料详解.md)
- [高级STK类型](../02-高级STK类型/)
- [实际示例](../05-实际示例/)