# PVF格式规范快速使用指南

## 🚀 核心格式规则（基于真实PVF文件分析）

⚠️ **重要更新**：基于真实PVF文件分析，格式规范与之前认知有重大差异！

### 1. 字符串格式
- ✅ 使用反引号：`` `字符串内容` ``
- ❌ 不要使用双引号：`"字符串内容"`
- ❌ 不要使用单引号：`'字符串内容'`

### 2. 参数分隔 ⚠️ **重要修正**
- ✅ 使用**制表符（Tab）**分隔参数（真实格式）
- ❌ 不要使用空格分隔参数
- 示例：`[icon mark]	`item.img`	14`

### 3. 缩进规则
- ✅ 使用制表符（Tab）进行缩进
- ❌ 不要使用空格缩进
- 每层嵌套使用一个Tab

### 4. 数字格式
- ✅ 直接写数字：`123`
- ❌ 不要给数字加引号：`"123"`

### 5. 行尾符 ⚠️ **重要修正**
- ✅ 使用CRLF（\r\n）行尾符
- ❌ 不要使用LF（\n）行尾符

### ✅ 正确格式（基于真实PVF文件）
```
#PVF_File

[name]	`精 · 加持的禁锢之限手镯 : [湮灭黑洞]`
[grade]	2
[rarity]	5
[icon mark]	`item/equipment.img`	0
[equipment type]	`[bracelet]`	23
[price]	632000
```

### ❌ 错误格式
```
[name] `装备名称`                 // 错误：标签和参数用空格分隔
[grade] 2                        // 错误：标签和参数用空格分隔
[icon mark] `item.img` 14        // 错误：参数间用空格分隔
[price] "1000"                   // 错误：数字加引号
```

## 🔧 工具使用流程

### 1. 格式检查（推荐第一步）
```bash
# PowerShell检查工具
.\Check-PVFFormat.ps1 "文件名.equ" -ShowDetails

# Python检查工具
python PVF格式检查工具.py "文件名.equ"
```

### 2. 格式转换（如有错误）
```bash
# 预览将要进行的更改
python PVF格式转换工具.py "文件名.equ" --dry-run

# 执行转换（建议先备份）
python PVF格式转换工具.py "文件名.equ" --backup

# 转换到新文件
python PVF格式转换工具.py "错误文件.equ" "正确文件.equ"
```

### 3. 验证转换结果
```bash
# 再次检查格式
.\Check-PVFFormat.ps1 "转换后文件.equ" -ShowDetails
```

## 📁 工具文件说明

| 文件名 | 用途 | 语言 |
|--------|------|------|
| `PVF文件格式规范.md` | 详细格式规范说明 | 文档 |
| `Check-PVFFormat.ps1` | 格式检查工具 | PowerShell |
| `PVF格式检查工具.py` | 格式检查工具 | Python |
| `PVF格式转换工具.py` | 自动格式修复工具 | Python |
| `格式转换工具使用说明.md` | 转换工具详细说明 | 文档 |

## ⚡ 快速命令参考

### 检查单个文件
```bash
.\Check-PVFFormat.ps1 "文件.equ" -ShowDetails
```

### 检查目录（递归）
```bash
python PVF格式检查工具.py "目录路径" --recursive
```

### 转换单个文件（带备份）
```bash
python PVF格式转换工具.py "文件.equ" --backup
```

### 批量转换目录
```bash
python PVF格式转换工具.py "目录路径" --recursive --backup
```

## 🎯 常见问题快速解决

### 问题1：引号格式错误
```
❌ [name] "装备名称"
✅ [name]	`装备名称`
```
**解决**：使用转换工具自动修复

### 问题2：参数分隔使用空格 ⚠️ **修正**
```
❌ [icon mark] `item.img` 14
✅ [icon mark]	`item.img`	14
```
**解决**：使用转换工具自动修复

### 问题3：数字加引号
```
❌ [price] "1000"
✅ [price]	1000
```
**解决**：使用转换工具自动修复

### 问题4：标签和参数用空格分隔 ⚠️ **修正**
```
❌ [grade] 2
✅ [grade]	2
```
**解决**：使用转换工具自动修复

### 问题5：行尾符错误 ⚠️ **新增**
```
❌ 使用LF（\n）行尾符
✅ 使用CRLF（\r\n）行尾符
```
**解决**：在编辑器中设置正确的行尾符

## 📝 编辑器设置建议

### VS Code ⚠️ **更新设置**
```json
{
    "editor.insertSpaces": false,
    "editor.detectIndentation": false,
    "editor.tabSize": 4,
    "files.eol": "\r\n",
    "editor.renderWhitespace": "all"
}
```

### Notepad++ ⚠️ **更新设置**
- 设置 → 首选项 → 语言 → 制表符设置
- 取消勾选"替换为空格"
- 制表符大小：4
- 编辑 → 文档格式转换 → 转为Windows格式（CRLF）
- 视图 → 显示符号 → 显示所有字符

## 🔍 验证清单 ⚠️ **重要更新**

在提交PVF文件前，请确认：

- [ ] 文件以 `#PVF_File` 开头
- [ ] 所有字符串使用反引号 `` ` `` 包围
- [ ] 数字不加任何引号
- [ ] 标签和参数之间使用**制表符（Tab）**分隔
- [ ] 多个参数之间使用**制表符（Tab）**分隔
- [ ] 标签格式正确 `[tag_name]`
- [ ] 缩进使用制表符（Tab），每层一个Tab
- [ ] 文件编码为UTF-8
- [ ] 行尾符为CRLF（\r\n）
- [ ] 通过格式检查工具验证

## 📞 获取帮助

如果遇到问题：
1. 查看 [PVF文件格式规范.md](./PVF文件格式规范.md)
2. 查看 [格式转换工具使用说明.md](./格式转换工具使用说明.md)
3. 使用 `--dry-run` 模式预览更改
4. 检查工具输出的错误信息

---

**记住**：格式正确是PVF文件能够正常工作的基础！