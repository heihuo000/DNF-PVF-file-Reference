# CHR文件攻击信息详解

## 概述

攻击信息标签定义了角色的攻击数据、武器信息、音效配置等战斗相关的详细参数。

## 攻击信息文件标签

### [attack info] - 攻击信息文件
定义攻击动作对应的攻击数据文件。

**语法：**
```
[attack info]	攻击动作	`攻击信息文件.atk`
```

**常用攻击动作：**
- `attack1` - 第一段攻击
- `attack2` - 第二段攻击  
- `attack3` - 第三段攻击
- `upper attack` - 上挑攻击
- `down attack` - 下劈攻击
- `dash attack` - 冲刺攻击
- `jump attack` - 跳跃攻击

**示例：**
```
[attack info]	attack1	`Attack1.atk`
[attack info]	attack2	`Attack2.atk`
[attack info]	attack3	`Attack3.atk`
[attack info]	upper attack	`UpperAttack.atk`
[attack info]	down attack	`DownAttack.atk`
[attack info]	dash attack	`DashAttack.atk`
[attack info]	jump attack	`JumpAttack.atk`
```

## 武器音效标签

### [weapon sound] - 武器音效
定义武器挥舞和攻击时的音效文件。

**语法：**
```
[weapon sound]	攻击动作	`音效文件.wav`
```

**示例：**
```
[weapon sound]	attack1	`sword_swing1.wav`
[weapon sound]	attack2	`sword_swing2.wav`
[weapon sound]	attack3	`sword_swing3.wav`
[weapon sound]	upper attack	`sword_upper.wav`
[weapon sound]	down attack	`sword_down.wav`
```

### [weapon hit sound] - 武器命中音效
定义武器命中目标时的音效文件。

**语法：**
```
[weapon hit sound]	攻击动作	`命中音效.wav`
```

**示例：**
```
[weapon hit sound]	attack1	`sword_hit1.wav`
[weapon hit sound]	attack2	`sword_hit2.wav`
[weapon hit sound]	attack3	`sword_hit3.wav`
```

## 武器信息标签

### [weapon hit info] - 武器命中信息
定义武器的命中判定和效果参数。

**语法：**
```
[weapon hit info]	攻击动作	命中类型	效果参数
```

**命中类型：**
- `normal` - 普通命中
- `critical` - 暴击命中
- `block` - 格挡
- `miss` - 未命中

**效果参数：**
- 伤害倍率
- 击退距离
- 硬直时间
- 特殊效果

**示例：**
```
[weapon hit info]	attack1	normal	1.0	50	300	none
[weapon hit info]	attack2	normal	1.2	80	400	none
[weapon hit info]	attack3	normal	1.5	120	500	knockdown
```

### [weapon skill info] - 武器技能信息
定义武器相关的技能信息和特殊效果。

**语法：**
```
[weapon skill info]	技能ID	技能等级	技能参数
```

**示例：**
```
[weapon skill info]	1001	1	100  // 技能ID 1001，等级1，参数100
[weapon skill info]	1002	3	150  // 技能ID 1002，等级3，参数150
```

## 攻击数据配置

### 基础攻击配置
```
// 攻击信息文件
[attack info]	attack1	`Attack1.atk`
[attack info]	attack2	`Attack2.atk`
[attack info]	attack3	`Attack3.atk`

// 武器音效
[weapon sound]	attack1	`sword_swing1.wav`
[weapon sound]	attack2	`sword_swing2.wav`
[weapon sound]	attack3	`sword_swing3.wav`

// 命中音效
[weapon hit sound]	attack1	`sword_hit1.wav`
[weapon hit sound]	attack2	`sword_hit2.wav`
[weapon hit sound]	attack3	`sword_hit3.wav`

// 命中信息
[weapon hit info]	attack1	normal	1.0	50	300	none
[weapon hit info]	attack2	normal	1.2	80	400	none
[weapon hit info]	attack3	normal	1.5	120	500	knockdown
```

### 特殊攻击配置
```
// 上挑攻击
[attack info]	upper attack	`UpperAttack.atk`
[weapon sound]	upper attack	`sword_upper.wav`
[weapon hit sound]	upper attack	`sword_hit_upper.wav`
[weapon hit info]	upper attack	normal	1.3	100	600	launch

// 下劈攻击
[attack info]	down attack	`DownAttack.atk`
[weapon sound]	down attack	`sword_down.wav`
[weapon hit sound]	down attack	`sword_hit_down.wav`
[weapon hit info]	down attack	normal	1.8	150	800	knockdown

// 冲刺攻击
[attack info]	dash attack	`DashAttack.atk`
[weapon sound]	dash attack	`sword_dash.wav`
[weapon hit sound]	dash attack	`sword_hit_dash.wav`
[weapon hit info]	dash attack	normal	2.0	200	1000	stun
```

## 音效文件规范

### 支持的音频格式
- `.wav` - 推荐格式，质量高，兼容性好
- `.ogg` - 压缩格式，文件小
- `.mp3` - 通用格式，但可能有延迟

### 音效文件命名规范
```
武器类型_动作_序号.wav
```

**示例：**
- `sword_swing1.wav` - 剑类武器挥舞音效1
- `sword_hit1.wav` - 剑类武器命中音效1
- `bow_shoot.wav` - 弓类武器射击音效
- `magic_cast.wav` - 魔法施法音效

### 音效参数建议
- **采样率**：22050Hz 或 44100Hz
- **位深度**：16位
- **声道**：单声道或立体声
- **文件大小**：建议小于500KB

## 攻击信息文件(.atk)结构

### ATK文件基本格式
```
[attack]
damage 伤害值
range 攻击范围
angle 攻击角度
effect 特殊效果
[/attack]
```

### ATK文件示例
```
[attack]
damage 100
range 80
angle 45
effect none
knockback 50
stun_time 300
[/attack]
```

## 特殊效果类型

### 击退效果
- `none` - 无特殊效果
- `knockback` - 击退
- `knockdown` - 击倒
- `launch` - 击飞
- `stun` - 眩晕
- `freeze` - 冰冻
- `burn` - 灼伤
- `poison` - 中毒
- `shock` - 感电

### 效果参数说明
```
[weapon hit info]	攻击动作	命中类型	伤害倍率	击退距离	硬直时间	特殊效果
```

**参数详解：**
- `伤害倍率`：基于基础攻击力的倍率（1.0 = 100%）
- `击退距离`：目标被击退的像素距离
- `硬直时间`：目标无法行动的时间（毫秒）
- `特殊效果`：附加的异常状态效果

## 连击系统配置

### 连击攻击配置
```
// 三段连击配置
[attack info]	attack1	`Attack1.atk`
[attack info]	attack2	`Attack2.atk`
[attack info]	attack3	`Attack3.atk`

// 连击伤害递增
[weapon hit info]	attack1	normal	1.0	30	200	none
[weapon hit info]	attack2	normal	1.3	50	300	none
[weapon hit info]	attack3	normal	1.8	100	500	knockdown
```

### 连击时间窗口
在CHR文件中可以设置连击的时间窗口：
```
[combo]	attack1	attack2	500  // attack1后500ms内可以接attack2
[combo]	attack2	attack3	600  // attack2后600ms内可以接attack3
```

## 性能优化建议

1. **音效文件优化**：
   - 使用合适的采样率和位深度
   - 压缩音频文件大小
   - 避免过长的音效文件

2. **攻击数据优化**：
   - 合理设置攻击范围和判定
   - 避免过于复杂的特殊效果
   - 优化攻击信息文件的加载

3. **内存管理**：
   - 及时释放不使用的音效资源
   - 使用音效池管理常用音效
   - 预加载关键攻击音效

## 调试和测试

### 攻击信息调试
1. 检查攻击信息文件是否存在
2. 验证音效文件的格式和路径
3. 测试攻击范围和伤害计算
4. 确认特殊效果的触发条件

### 常见问题排查
1. **音效不播放**：检查文件路径和格式
2. **攻击无效果**：验证ATK文件的参数设置
3. **伤害计算错误**：检查伤害倍率和基础攻击力
4. **特殊效果失效**：确认效果类型和参数

## 相关文档

- [动画标签详解](../03-动画标签/动画标签详解.md)
- [属性标签详解](../02-属性标签/属性标签详解.md)
- [完整CHR示例](../06-实际示例/完整CHR示例.md)
- [常见问题解答](../07-常见问题/攻击相关问题.md)