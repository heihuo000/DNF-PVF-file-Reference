# CHR文件依赖文件简介

## 📋 概述

CHR文件（Character文件）定义角色的基础属性和行为，但需要依赖多种其他文件类型来实现完整的角色功能。本文档详细介绍这些依赖文件的作用、格式和使用方法。

---

## 🎬 动画文件 (.ani)

### 作用
定义角色的各种动作动画，包括待机、移动、攻击、技能、受伤等所有动作表现。

### 文件位置
```
character/[职业名称]/[动作名称].ani
```

### 在CHR文件中的引用
```chr
[wait motion] `character/swordman/wait.ani`           // 待机动画
[move motion] `character/swordman/move.ani`           // 移动动画
[attack motion] `character/swordman/attack.ani`       // 普通攻击动画
[jump motion] `character/swordman/jump.ani`           // 跳跃动画
[dash motion] `character/swordman/dash.ani`           // 冲刺动画
[skill motion] `character/swordman/skill_01.ani`      // 技能动画
[damage motion] `character/swordman/damage.ani`       // 受伤动画
[down motion] `character/swordman/down.ani`           // 倒地动画
```

### 常用动画类型
- **wait** - 待机动画（循环播放）
- **move** - 移动动画（循环播放）
- **attack** - 普通攻击动画
- **skill** - 技能动画（多个文件）
- **jump** - 跳跃动画
- **dash** - 冲刺/闪避动画
- **damage** - 受伤动画
- **down** - 倒地动画
- **sit** - 坐下动画
- **cast** - 施法动画

### 注意事项
- 动画文件必须存在，否则角色显示异常
- 动画帧数影响动作流畅度和技能释放时机
- 攻击动画的帧数要与攻击判定时机匹配

---

## ⚔️ 装备文件 (.equ)

### 作用
定义角色可装备的武器、防具等装备的外观、属性和特效。

### 文件位置
```
equipment/[装备类型]/[装备名称].equ
```

### 在CHR文件中的引用
```chr
[equipment]
	`equipment/weapon/sword/basic_sword.equ`      // 基础武器
	`equipment/armor/cloth/basic_cloth.equ`       // 基础防具
	`equipment/accessory/ring/basic_ring.equ`     // 基础饰品
```

### 装备类型
- **武器** - 影响攻击动画和伤害
- **防具** - 改变角色外观和防御
- **饰品** - 提供特殊属性加成
- **时装** - 纯外观装备

### 装备与CHR的关系
```chr
[usable equipment]
	[weapon] `[sword]` `[blunt]` `[katana]`       // 可使用的武器类型
	[armor] `[cloth]` `[leather]` `[plate]`       // 可使用的防具类型
	[accessory] `[ring]` `[necklace]` `[bracelet]` // 可使用的饰品类型
```

---

## 🎯 技能文件 (.skl)

### 作用
定义角色可学习和使用的技能，包括主动技能、被动技能、觉醒技能等。

### 文件位置
```
skill/[职业名称]/[技能名称].skl
```

### 在CHR文件中的引用
```chr
[skill tree] `skill/swordman/skill_tree.co`      // 技能树配置
[basic skill] `skill/swordman/basic_attack.skl`  // 基础技能
[class skill] `skill/swordman/uppercut.skl`      // 职业技能
```

### 技能类型
- **基础技能** - 所有角色共有的基础能力
- **职业技能** - 特定职业的专属技能
- **觉醒技能** - 高等级解锁的强力技能
- **被动技能** - 持续生效的能力加成

### 技能树配置 (.co)
```co
[skill tree]
	[skill node]
		[skill] `skill/swordman/uppercut.skl`
		[position] 100 200
		[require level] 15
		[require sp] 20
```

---

## ✨ 特效文件 (.ptl)

### 作用
定义各种视觉特效，如技能特效、状态特效、环境特效等。

### 文件位置
```
passiveobject/[特效分类]/[特效名称].ptl
```

### 在CHR文件中的引用
```chr
[level up effect] `passiveobject/character/levelup.ptl`     // 升级特效
[aura effect] `passiveobject/character/aura.ptl`           // 光环特效
[buff effect] `passiveobject/character/buff.ptl`           // 增益特效
[debuff effect] `passiveobject/character/debuff.ptl`       // 减益特效
```

### 特效类型
- **level up effect** - 升级时的特效
- **aura effect** - 持续的光环特效
- **buff effect** - 增益状态特效
- **debuff effect** - 减益状态特效
- **skill effect** - 技能释放特效（在技能文件中定义）

---

## 🔊 音效文件 (.wav, .ogg)

### 作用
为角色的各种动作和状态提供音效支持。

### 在CHR文件中的引用
```chr
[speech on situation]
	[on attack] `SWORDMAN_ATTACK_01`        // 攻击时音效
	[on damage] `SWORDMAN_DAMAGE_01`        // 受伤时音效
	[on skill] `SWORDMAN_SKILL_01`          // 技能释放音效
	[on level up] `LEVEL_UP_01`             // 升级音效

[voice]
	[attack voice] `SWORDMAN_VOICE_ATTACK`  // 攻击语音
	[skill voice] `SWORDMAN_VOICE_SKILL`    // 技能语音
```

### 音效类型
- **动作音效** - 攻击、移动、跳跃
- **技能音效** - 技能释放和命中
- **状态音效** - 受伤、死亡、升级
- **语音** - 角色配音和战斗呐喊

---

## 🖼️ 图像文件 (.img)

### 作用
提供角色的头像、图标、UI元素等静态图像。

### 在CHR文件中的引用
```chr
[face image] `character/swordman/face.img`        // 角色头像
[mini map icon] `character/swordman/minimap.img`  // 小地图图标
[portrait] `character/swordman/portrait.img`      // 肖像图
```

### 图像类型
- **face image** - 角色头像（用于UI显示）
- **mini map icon** - 小地图显示图标
- **portrait** - 详细肖像图
- **class icon** - 职业图标

---

## 🎨 外观文件 (.ava)

### 作用
定义角色的外观变化，如时装、变身效果等。

### 文件位置
```
avatar/[职业名称]/[外观名称].ava
```

### 在CHR文件中的引用
```chr
[avatar]
	[default avatar] `avatar/swordman/default.ava`    // 默认外观
	[class avatar] `avatar/swordman/advanced.ava`     // 转职外观
```

### 外观类型
- **default avatar** - 默认外观
- **class avatar** - 转职后外观
- **costume avatar** - 时装外观
- **transform avatar** - 变身外观

---

## 📊 数据表文件 (.lst)

### 作用
管理角色的分类、等级、属性等系统数据。

### 相关数据表
- **character.lst** - 角色基础数据
- **level.lst** - 等级经验数据
- **skill.lst** - 技能数据索引
- **equipment.lst** - 装备数据索引
- **job.lst** - 职业数据

### 在系统中的作用
```lst
[character data]
	[job id] 0                    // 职业ID
	[job name] `剑士`             // 职业名称
	[chr file] `character/swordman/swordman.chr`  // CHR文件路径
```

---

## 🗺️ 地图文件 (.map)

### 作用
定义角色的出生点和在地图中的行为规则。

### 角色生成设置
```map
[character spawn]
	[position] 100 200            // 出生位置
	[direction] 1                 // 面向方向
	[default character] `character/swordman/swordman.chr`
```

---

## 🔗 依赖关系图

```
CHR文件 (.chr)
├── 动画文件 (.ani) - 必需
│   ├── wait.ani
│   ├── move.ani
│   ├── attack.ani
│   └── skill_*.ani
├── 技能文件 (.skl) - 必需
│   ├── basic_attack.skl
│   ├── class_skill.skl
│   └── skill_tree.co
├── 装备文件 (.equ) - 可选
│   ├── weapon.equ
│   ├── armor.equ
│   └── accessory.equ
├── 特效文件 (.ptl) - 可选
│   ├── levelup.ptl
│   ├── aura.ptl
│   └── buff.ptl
├── 音效文件 (.wav/.ogg) - 可选
│   ├── attack.wav
│   ├── skill.wav
│   └── voice.wav
├── 图像文件 (.img) - 可选
│   ├── face.img
│   ├── portrait.img
│   └── icon.img
├── 外观文件 (.ava) - 可选
│   ├── default.ava
│   └── class.ava
└── 数据表文件 (.lst) - 系统级
    ├── character.lst
    ├── skill.lst
    └── equipment.lst
```

---

## 🛠️ 创建依赖文件的工具

### 推荐工具
1. **PVF编辑器** - 可视化编辑各种文件
2. **动画编辑器** - 创建和编辑.ani文件
3. **技能编辑器** - 创建和编辑.skl文件
4. **特效编辑器** - 创建和编辑.ptl文件
5. **音频编辑器** - 处理音效文件
6. **图像编辑器** - 创建头像和图标

### 文件格式要求
- 音频：WAV、OGG格式，采样率22050Hz或44100Hz
- 图像：IMG格式（DNF专用），支持透明通道
- 动画：ANI格式（DNF专用），包含帧数据和时间信息
- 技能：SKL格式，遵循标签语法规范

---

## ⚠️ 注意事项

### 文件路径
- 所有路径都是相对于PVF根目录
- 路径分隔符使用正斜杠 `/`
- 路径区分大小写
- 字符串路径必须用反引号 `` ` `` 包围

### 文件命名
- 使用英文命名，避免中文字符
- 文件名不要包含空格和特殊字符
- 保持命名的一致性和可读性
- 遵循官方命名规范

### 性能考虑
- 动画文件帧数要适中，避免过度细腻
- 特效文件要控制数量，避免性能问题
- 音效文件要适当压缩，平衡质量和大小
- 技能数量要合理，避免技能树过于复杂

### 兼容性
- 确保所有依赖文件都存在且路径正确
- 检查文件格式的正确性和完整性
- 测试在不同分辨率下的显示效果
- 验证与其他MOD的兼容性

### 格式规范
- 严格遵循标签语法，使用正确的缩进
- 字符串必须用反引号包围，不能用双引号
- 数值类型要符合取值范围要求
- 注释要使用 `//` 格式

---

## 📚 学习建议

1. **从基础开始** - 先掌握基本的动画和技能配置
2. **参考官方文件** - 学习官方角色的文件结构和命名规范
3. **逐步完善** - 先实现基本功能，再添加特效和音效
4. **测试验证** - 每次修改后都要在游戏中测试效果
5. **备份重要文件** - 避免误操作导致文件丢失
6. **学习工具使用** - 熟练掌握各种编辑工具的使用方法
7. **关注性能** - 在追求效果的同时要考虑游戏性能

---

## 🔧 常见问题解决

### 角色不显示
- 检查动画文件是否存在
- 验证CHR文件中的路径是否正确
- 确认图像文件格式是否正确

### 技能无法使用
- 检查技能文件是否存在
- 验证技能树配置是否正确
- 确认技能ID是否冲突

### 特效不显示
- 检查特效文件路径是否正确
- 验证特效文件格式是否正确
- 确认特效触发条件是否满足

### 音效无法播放
- 检查音效文件格式是否支持
- 验证音效文件路径是否正确
- 确认音效触发时机是否正确

---

*依赖文件的正确配置是创建完整CHR文件的关键，建议在实际制作中多参考官方示例并进行充分测试。*