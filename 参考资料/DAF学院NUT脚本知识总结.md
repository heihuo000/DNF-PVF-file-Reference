# DAF学院NUT脚本知识总结

## 目录
- [概述](#概述)
- [NUT脚本基础概念](#nut脚本基础概念)
- [核心函数详解](#核心函数详解)
- [对象和方法](#对象和方法)
- [常用常量](#常用常量)
- [学习路径推荐](#学习路径推荐)
- [实战案例](#实战案例)
- [参考资源](#参考资源)

## 概述

NUT脚本是DNF游戏中用于实现技能逻辑、状态控制和游戏机制的核心脚本语言。本文档整合了DAF学院的NUT教程资源，为学习者提供系统化的知识总结。

## NUT脚本基础概念

### State（状态）概念
- **定义**: State是NUT脚本中的核心概念，代表角色或对象的当前状态
- **作用**: 控制技能的执行流程、动画播放、伤害计算等
- **状态转换**: 通过特定函数实现状态之间的切换

### 主要组成部分
1. **状态定义**: 使用枚举定义各种状态
2. **时间事件**: 控制技能的时序逻辑
3. **变量管理**: 存储和传递数据
4. **函数实现**: 具体的逻辑处理

## 核心函数详解

### 技能检查函数
```nut
checkExecutableSkill_[技能名]
```
- **功能**: 检查技能是否可以执行
- **返回值**: true/false
- **常用检查**: MP消耗、冷却时间、前置条件等

### 状态设置函数
```nut
onSetState_[技能名]
```
- **功能**: 设置技能状态时的初始化操作
- **作用**: 设置动画、初始化变量、播放音效等

### 时间事件函数
```nut
onTimeEvent_[技能名]
```
- **功能**: 处理技能执行过程中的时间事件
- **用途**: 控制技能的各个阶段、触发特效等

### 攻击函数
```nut
onAttack_[技能名]
```
- **功能**: 处理技能的攻击逻辑
- **包含**: 伤害计算、命中判定、特殊效果等

### 结束函数
```nut
onEndState_[技能名]
```
- **功能**: 技能状态结束时的清理操作
- **作用**: 重置变量、清除效果、恢复状态等

## 对象和方法

### obj对象常用方法

#### 技能相关
- `obj.sq_IsUseSkill()` - 检查是否正在使用技能
- `obj.sq_AddSetStatePacket()` - 添加状态设置包
- `obj.sq_StopMove()` - 停止移动
- `obj.sq_SetCurrentAnimation()` - 设置当前动画

#### 移动控制
- `obj.sq_SetVelocity()` - 设置速度
- `obj.sq_GetDistancePos()` - 获取距离位置
- `obj.sq_MoveWithVelocity()` - 以指定速度移动

#### 状态管理
- `obj.sq_GetState()` - 获取当前状态
- `obj.sq_SetState()` - 设置状态
- `obj.sq_IsState()` - 检查是否为指定状态

#### 属性获取
- `obj.sq_GetLevel()` - 获取等级
- `obj.sq_GetSTR()` - 获取力量
- `obj.sq_GetINT()` - 获取智力
- `obj.sq_GetMaxHP()` - 获取最大HP

### damager对象方法
- `damager.sq_SetDamage()` - 设置伤害值
- `damager.sq_SetAttackInfo()` - 设置攻击信息
- `damager.sq_SetHitInfo()` - 设置命中信息

## 常用常量

### 攻击类型
- `ATTACKTYPE_PHYSICAL` - 物理攻击
- `ATTACKTYPE_MAGICAL` - 魔法攻击
- `ATTACKTYPE_INDEPENDENT` - 固定伤害

### 属性类型
- `ENUM_STAT_PHYSICAL_ATTACK` - 物理攻击力
- `ENUM_STAT_MAGICAL_ATTACK` - 魔法攻击力
- `ENUM_STAT_PHYSICAL_DEFENSE` - 物理防御力
- `ENUM_STAT_MAGICAL_DEFENSE` - 魔法防御力

### 状态效果
- `STATE_STUN` - 眩晕状态
- `STATE_FREEZE` - 冰冻状态
- `STATE_BURN` - 燃烧状态
- `STATE_POISON` - 中毒状态

### 方向常量
- `ENUM_DIRECTION_LEFT` - 左方向
- `ENUM_DIRECTION_RIGHT` - 右方向
- `ENUM_DIRECTION_UP` - 上方向
- `ENUM_DIRECTION_DOWN` - 下方向

## 学习路径推荐

### 入门阶段
1. **基础概念理解**
   - 学习State概念
   - 了解主要函数结构
   - 掌握基本语法

2. **简单技能制作**
   - 单动作技能
   - 基础伤害应用
   - 动画设置

### 进阶阶段
1. **多动作技能**
   - 技能连招
   - 强制中断机制
   - 状态转换

2. **特殊技能类型**
   - 抓取技能
   - 镜头移动
   - 距离移动

3. **数据传递**
   - 变量管理
   - 参数传递
   - 状态保存

### 高级阶段
1. **BUFF系统**
   - 主动BUFF
   - 被动技能
   - 状态叠加

2. **复杂机制**
   - 特效真伤
   - 体术技能
   - 动态调试

## 实战案例

### 案例1：冰之破碎技能
基于`11724_nut解读.json`的分析：

**状态定义**:
```nut
ENUM_ICE_CRASH_SUBSTATE_READY = 0;      // 准备状态
ENUM_ICE_CRASH_SUBSTATE_ATTACK = 1;     // 攻击状态
ENUM_ICE_CRASH_SUBSTATE_END = 2;        // 结束状态
```

**核心实现**:
- 技能触发检查
- 状态转换控制
- 动画设置
- 伤害计算
- 敌人控制
- 粒子效果

### 案例2：主动技能基本结构
基于咸鱼Z教程系列：

1. **技能添加流程**
2. **伤害应用方法**
3. **多动作技能实现**
4. **强制中断机制**

## 参考资源

### 在线教程
- [咸鱼Z教程系列](https://www.123pan.com/s/tJCtVv-xQ6EH.html) (提取码: gx9k)
- [Bilibili教程合集](https://www.bilibili.com/read/cv3486413)

### 教程列表
1. **入门级教程**
   - Nut入门级之添加技能及伤害应用
   - Nut入门级之多动作技能及强制中断
   - Nut入门级之抓取技能及镜头移动
   - Nut入门教程之距离移动及数据传递
   - Nut入门教程之主动BUFF与被动

2. **实例教程**
   - nut修改实例1：主动技能基本结构
   - nut修改实例2：主动技能添加
   - nut修改实例3：完成血爆-第一部分
   - nut修改实例4：特效真伤，附完成血爆-第二部分
   - nut修改实例5：多动作技能(以红狗为例)
   - nut修改实例6：体术和特效真伤(完善红狗)
   - nut修改实例7：buff技能
   - nut修改实例8：多动作技能(以红狗为例)

3. **高级教程**
   - [教程]关于在台服端伪实现全彩残影的教程

### 文档资源
- [腾讯文档 - NUT完整文档](https://docs.qq.com/doc/DUkRQcVJGZkVOcVpG)
- NUT说明文档（学员上传）
- nut基本信息常量表

## 注意事项

1. **格式规范**: 严格遵守PVF文件格式规范，避免游戏崩溃
2. **字符串格式**: 使用反引号(\`)而不是双引号(\")包围字符串
3. **缩进规范**: 使用Tab键而不是空格进行缩进
4. **调试方法**: 掌握动态调试技巧，提高开发效率

## 总结

NUT脚本是DNF技能开发的核心技术，需要系统学习和大量实践。建议按照推荐的学习路径逐步深入，结合实际案例进行练习，逐步掌握从基础技能到复杂机制的开发能力。

---
*本文档基于DAF学院NUT教程资源整理，持续更新中...*