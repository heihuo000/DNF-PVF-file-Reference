# MAP文件标签参考

> 🏷️ 所有MAP标签的完整参考手册，包含功能说明、参数详解和实用案例

## 📋 目录

- [基础信息标签](#基础信息标签)
- [地图属性标签](#地图属性标签)
- [瓦片配置标签](#瓦片配置标签)
- [移动区域标签](#移动区域标签)
- [音效配置标签](#音效配置标签)
- [动画配置标签](#动画配置标签)
- [对象配置标签](#对象配置标签)
- [怪物配置标签](#怪物配置标签)
- [特殊功能标签](#特殊功能标签)

---

## 基础信息标签

### `[map info]`
**功能**: 地图基础信息配置
**适用**: 所有地图类型
**必需**: ✅

```map
[map info]
	`map type`	`town`		// 地图类型: town(城镇) / dungeon(副本) / pvp(PVP)
	`width`		800		// 地图宽度(像素)
	`height`	600		// 地图高度(像素)
	`tile width`	32		// 瓦片宽度
	`tile height`	32		// 瓦片高度
	`map name`	`塞利亚房间`	// 地图显示名称
```

**参数说明**:
- `map type`: 决定地图的基本行为和可用功能
- `width/height`: 地图的像素尺寸，影响相机范围
- `tile width/height`: 瓦片尺寸，通常为32x32
- `map name`: 游戏中显示的地图名称

### `[layer info]`
**功能**: 图层信息配置
**适用**: 所有地图类型
**必需**: ✅

```map
[layer info]
	`layer count`	3		// 图层数量
	`layer 0`	`back`		// 背景层
	`layer 1`	`tile`		// 瓦片层
	`layer 2`	`obj`		// 对象层
```

---

## 地图属性标签

### `[map attribute]`
**功能**: 地图属性和行为配置
**适用**: 所有地图类型
**必需**: ✅

```map
[map attribute]
	`skill no effect`	0	// 技能无效果: 0(正常) / 1(无效)
	`sound reverb`		0	// 音效混响: 0-100
	`bgm`			`Music/town_seria.ogg`	// 背景音乐文件
	`camera limit rect`	0	0	800	600	// 相机限制区域
```

**常用配置**:
- **城镇地图**: `skill no effect` = 1 (禁用技能)
- **副本地图**: `skill no effect` = 0 (允许技能)
- **PVP地图**: 需要特殊的相机和音效配置

### `[elemental property]`
**功能**: 元素属性配置
**适用**: 副本地图
**必需**: ❌

```map
[elemental property]
	`no effect`		0	// 无元素效果
	`water level`		0	// 水位高度
	`fire damage`		0	// 火焰伤害
```

---

## 瓦片配置标签

### `[tile info]`
**功能**: 瓦片基础信息
**适用**: 所有地图类型
**必需**: ✅

```map
[tile info]
	`tile total`		100	// 瓦片总数
	`tile attribute`	`tile/town.til`	// 瓦片属性文件
	`tile image`		`tile/town.img`	// 瓦片图像文件
```

### `[extended tile]`
**功能**: 扩展瓦片配置
**适用**: 复杂地图
**必需**: ❌

```map
[extended tile]
	`animation tile count`	5	// 动画瓦片数量
	`animation tile 0`	10	20	30	// 动画帧序列
```

---

## 移动区域标签

### `[movable area]`
**功能**: 可移动区域定义
**适用**: 所有地图类型
**必需**: ✅

```map
[movable area]
	`area count`	1
	`area 0`	0	0	800	600	// x, y, width, height
```

### `[town movable area]`
**功能**: 城镇专用移动区域
**适用**: 城镇地图
**必需**: ✅

```map
[town movable area]
	`area count`	2
	`area 0`	100	100	200	150	// 主要活动区域
	`area 1`	350	200	100	100	// 次要区域
```

### `[virtual movable area]`
**功能**: 虚拟移动区域(不可见边界)
**适用**: 所有地图类型
**必需**: ❌

```map
[virtual movable area]
	`area count`	1
	`area 0`	-50	-50	900	700	// 扩展边界
```

---

## 音效配置标签

### `[sound]`
**功能**: 环境音效配置
**适用**: 所有地图类型
**必需**: ❌

```map
[sound]
	`sound count`	2
	`sound 0`	`Sound/town_ambient.ogg`	100	100	50	// 文件, x, y, 音量
	`sound 1`	`Sound/water_flow.ogg`		200	300	30
```

### `[opening bgm]`
**功能**: 开场背景音乐
**适用**: 副本地图
**必需**: ❌

```map
[opening bgm]
	`file name`	`Music/dungeon_intro.ogg`
	`play time`	5000	// 播放时长(毫秒)
```

---

## 动画配置标签

### `[animation]`
**功能**: 地图动画配置
**适用**: 所有地图类型
**必需**: ❌

```map
[animation]
	`ani count`	1
	`ani 0`
		`ani file name`		`sprite/map_effect.ani`
		`ani pos`		400	300	// x, y坐标
		`ani loop`		1	// 是否循环
		`ani play speed`	100	// 播放速度(%)
```

### `[background animation]`
**功能**: 背景动画配置
**适用**: 所有地图类型
**必需**: ❌

```map
[background animation]
	`ani info count`	1
	`ani info 0`
		`file name`	`sprite/bg_clouds.ani`
		`pos`		0	0	800	600
		`loop`		1
		`speed`		50
```

---

## 对象配置标签

### `[passive object]`
**功能**: 被动对象配置(NPC、装饰等)
**适用**: 所有地图类型
**必需**: ❌

```map
[passive object]
	`obj count`	2
	`obj 0`
		`file name`	`passiveobject/npc_seria.po`
		`pos`		400	300	// x, y坐标
		`z pos`		0	// z轴位置
		`direction`	1	// 朝向: 0(左) / 1(右)
	`obj 1`
		`file name`	`passiveobject/furniture_table.po`
		`pos`		200	250
		`z pos`		-10
```

**常用对象类型**:
- **NPC**: 商店、任务、功能NPC
- **装饰**: 家具、植物、建筑装饰
- **功能**: 传送门、机关、特殊装置

---

## 怪物配置标签

### `[monster]`
**功能**: 怪物配置
**适用**: 副本地图
**必需**: ❌

```map
[monster]
	`monster count`	3
	`monster 0`
		`file name`	`monster/goblin.mon`
		`pos`		300	200
		`level`		25
		`ai pattern`	`normal`
	`monster 1`
		`file name`	`monster/orc.mon`
		`pos`		500	300
		`level`		27
		`ai pattern`	`aggressive`
```

### `[monster condition]`
**功能**: 怪物出现条件
**适用**: 副本地图
**必需**: ❌

```map
[monster condition]
	`condition count`	1
	`condition 0`
		`monster index`	0	// 对应monster中的索引
		`appear condition`	`room_clear`	// 出现条件
		`appear delay`		2000		// 延迟时间(毫秒)
```

### `[blood monster]`
**功能**: 血腥模式怪物替换
**适用**: 副本地图
**必需**: ❌

```map
[blood monster]
	`replace count`	1
	`replace 0`
		`original`	`monster/goblin.mon`
		`blood`		`monster/goblin_blood.mon`
```

---

## 特殊功能标签

### `[pathgate pos]`
**功能**: 传送门位置配置
**适用**: 城镇地图
**必需**: ❌

```map
[pathgate pos]
	`gate count`	2
	`gate 0`	100	500	`dungeon_entrance`	// x, y, 目标ID
	`gate 1`	700	500	`shop_area`
```

### `[dungeon start area]`
**功能**: 副本起始区域
**适用**: 副本地图
**必需**: ✅

```map
[dungeon start area]
	`area count`	1
	`area 0`	50	550	100	50	// x, y, width, height
```

### `[static player start pos]`
**功能**: 玩家固定起始位置
**适用**: 所有地图类型
**必需**: ❌

```map
[static player start pos]
	`pos count`	4
	`pos 0`		100	500	// 玩家1位置
	`pos 1`		120	500	// 玩家2位置
	`pos 2`		140	500	// 玩家3位置
	`pos 3`		160	500	// 玩家4位置
```

### `[guild agit entrance info]`
**功能**: 公会基地入口信息
**适用**: 城镇地图
**必需**: ❌

```map
[guild agit entrance info]
	`entrance count`	1
	`entrance 0`
		`pos`		400	300
		`size`		50	50
		`target map`	`guild_hall`
```

### `[far sight scroll]` / `[middle sight scroll]` / `[near sight scroll]`
**功能**: 视野滚动配置
**适用**: 大型地图
**必需**: ❌

```map
[far sight scroll]
	`scroll speed`	100	// 滚动速度
	`scroll range`	0	0	1600	1200	// 滚动范围

[middle sight scroll]
	`scroll speed`	150
	`scroll range`	0	0	800	600

[near sight scroll]
	`scroll speed`	200
	`scroll range`	0	0	400	300
```

---

## 💡 使用技巧

### 1. 标签组合使用
```map
// 城镇地图标准组合
[map info] + [layer info] + [map attribute] + [town movable area] + [passive object]

// 副本地图标准组合  
[map info] + [layer info] + [map attribute] + [movable area] + [dungeon start area] + [monster]

// PVP地图标准组合
[map info] + [layer info] + [map attribute] + [movable area] + [static player start pos]
```

### 2. 性能优化建议
- 限制动画数量，避免过多`[animation]`标签
- 合理设置`[movable area]`，避免过大区域
- 音效文件使用压缩格式，控制文件大小

### 3. 常见错误避免
- 字符串必须用反引号 `` 包围
- 坐标值不能超出地图尺寸
- 文件路径使用正斜杠 `/`
- 标签必须正确配对和缩进

---

## 📚 相关链接

- [模板文件](模板文件/) - 标准地图模板
- [实际案例](实际案例/) - 完整使用示例  
- [常见问题.md](常见问题.md) - 错误排查指南